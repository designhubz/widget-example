{"version":3,"file":"Designhubz.umd.js","sources":["../src/packages/data/Data.ts","../src/packages/data/Com.ts","../src/packages/data/WidgetTypes.ts","../src/packages/data/index.ts","../src/packages/data-source/MockData.ts","../src/packages/data-source/InlineFrame.ts","../src/packages/lib/_Dev.ts","../src/packages/lib/_Data.ts","../src/packages/lib/products/_Product.ts","../src/packages/utils/Browser.ts","../src/packages/utils/Signals.ts","../src/packages/utils/index.ts","../src/packages/lib/widgets/Snapshot.ts","../src/packages/lib/widgets/_Widget.ts","../src/packages/lib/widgets/_3DWidget.ts","../src/packages/lib/products/_3DProduct.ts","../src/packages/lib/widgets/_EyewearWidget.ts","../src/packages/lib/products/_EyewearProduct.ts","../src/packages/lib/products/Factory.ts","../src/packages/lib/_Config.ts","../src/packages/lib/_API.ts","../src/packages/lib/index.ts"],"sourcesContent":["import { IProduct, IDigitization, IClientConfig, Input, IContent } from './Storage';\r\nimport { IScene, ISkin } from './Internal';\r\n\r\nclass CustomError\r\n{\r\n\tpublic name?: string;\r\n\tpublic stack?: string;\r\n\tpublic message?: string;\r\n\r\n\tconstructor(error?: string | Error) \r\n\t{\r\n\t\tlet errorObject: Error;\r\n\t\tif(error === undefined || typeof error === 'string') errorObject = new Error(error);\r\n\t\telse errorObject = error;\r\n\t\tObject.assign(this, errorObject);\r\n\t}\r\n}\r\n\r\nexport namespace Errors\r\n{\r\n    export class NotFoundError extends CustomError\r\n    {\r\n        constructor()\r\n        {\r\n            super('NotFoundError');\r\n        }\r\n    }\r\n\r\n    export class AuthenticationError extends CustomError\r\n    {\r\n        constructor()\r\n        {\r\n            super('AuthenticationError');\r\n        }\r\n    }\r\n\r\n    export type ProductData = NotFoundError | AuthenticationError;\r\n    export type Session = NotFoundError | AuthenticationError;\r\n    export type Scene = NotFoundError | AuthenticationError;\r\n    export type Skin = NotFoundError | AuthenticationError;\r\n    export type DigitizationData = NotFoundError;\r\n}\r\n\r\ninterface IWidgetApps\r\n{\r\n    viewer: (workspaceId?: string, referenceId?: string) => string;\r\n    eyewear: (workspaceKey?: string, productKey?: string) => string;\r\n}\r\n\r\nexport interface IWidgetData\r\n{\r\n    readonly apps: IWidgetApps;\r\n\r\n    FetchClientConfig(): Promise<IClientConfig>;\r\n    FetchProduct(workspaceId: string, referenceId: string, collectVariationDetails: boolean): Promise<IProduct>;\r\n    FetchProducts(workspaceId: string, referenceIdArray: string[], collectVariationDetails: boolean): Promise<Record<string, IProduct>>;\r\n    \r\n    /** @returns sessionId */\r\n    CreateSession(workspaceId: string, referenceId: string, userId: string): Promise<string>;\r\n    UpdateSession(sessionId: string, data: Input.ISessionData): Promise<void>;\r\n}\r\n\r\nexport interface IViewerData extends IWidgetData\r\n{\r\n    FetchScene(workspaceId: string, referenceId: string): Promise<IScene>;\r\n    \r\n    FetchSkin(workspaceId: string): Promise<ISkin>;\r\n}\r\n\r\ninterface IEditorApps extends IWidgetApps\r\n{\r\n    editor: (params?: {}) => string;\r\n    digitization: (params?: {}) => string;\r\n}\r\n\r\nexport interface IEditorData extends IViewerData\r\n{\r\n    readonly apps: IEditorApps;\r\n\r\n    CreateScene(workspaceId: string, referenceId: string, name: string, sceneData?: Input.TJSON, files?: Input.IUploadAsset[]): Promise<IScene>;\r\n    UpdateScene(workspaceId: string, referenceId: string, update: {\r\n        name?: string, // Not implemented server side\r\n        sceneData?: Input.TJSON\r\n    }): Promise<IScene>;\r\n    DeleteScene(workspaceId: string, referenceId: string): Promise<void>;\r\n\r\n    UploadSceneAssets(workspaceId: string, referenceId: string, files: Input.IUploadAsset[]): Promise<IScene>;\r\n    DeleteSceneAssets(workspaceId: string, referenceId: string, names: string[]): Promise<IScene>;\r\n\r\n    CreateSkin(workspaceId: string, skinData: Input.TJSON, files: Input.IUploadAsset[]): Promise<ISkin>;\r\n    DeleteSkin(workspaceId: string): Promise<void>;\r\n\r\n    FetchDigitization(workspaceId: string, modelCode: string): Promise<IDigitization>;\r\n\r\n    FetchContent(url: string): Promise<IContent>;\r\n}\r\n","// Original source in @designhubz-widget\r\n\r\ntype IternallyMutable<T> = {\r\n    -readonly [K in keyof T]: T[K] \r\n};\r\n\r\nexport declare namespace Com\r\n{\r\n    export const enum MsgType\r\n    {\r\n        Init = 'init',\r\n        Progress = 'Progress'\r\n    }\r\n\r\n    export interface IMsgData\r\n    {\r\n        __Designhubz: true;\r\n        __id: number;\r\n        __type: string;\r\n        __details?: any;\r\n    }\r\n\r\n    export interface IStreamMsgData extends IMsgData\r\n    {\r\n        __completed: boolean;\r\n        __streamId: string;\r\n    }\r\n\r\n    export interface IExternalMsg extends Omit<IMsgData, '__Designhubz' | '__id'>\r\n    {}\r\n\r\n    export interface IInitRequest extends IExternalMsg\r\n    {\r\n        __type: MsgType.Init;\r\n        /** origin */\r\n        __details: string;\r\n    }\r\n\r\n    export interface IInitResponse extends IInitRequest \r\n    {}\r\n\r\n    // #region progress\r\n\r\n    export interface IProgressData\r\n    {\r\n        readonly id: string;\r\n        /** @param progress Normalized [0, 1] progress value */\r\n        readonly progress: number;\r\n        readonly completed: boolean;\r\n        readonly error?: string;\r\n    }\r\n\r\n    export interface IProgressRequest extends Com.IExternalMsg\r\n    {\r\n        __type: MsgType.Progress;\r\n        __details: {\r\n            id: string;\r\n            autoRemove?: boolean;\r\n        };\r\n    }\r\n\r\n    export interface IProgressResponse extends Com.IExternalMsg\r\n    {\r\n        __type: MsgType.Progress;\r\n        __details: IProgressData;\r\n    }\r\n\r\n    export type TProgressCallback = (data: IProgressData) => void;\r\n}\r\n\r\nexport class Com\r\n{\r\n    public static source = 'Com';\r\n\r\n    protected readonly waitForInit: Promise<void>;\r\n\r\n    protected _origin?: string;\r\n\r\n    private _id = 0;\r\n    private _pending = new Map<number, (arg: any) => void>();\r\n    private _streams = new Map<string, (arg: any) => void>();\r\n\r\n    constructor(onError?: (ev: MessageEvent) => void)\r\n    {\r\n        this.waitForInit = new Promise<void>( initResolver => {\r\n\r\n            window.addEventListener('message', async ev => {\r\n                if(ev.origin === window.location.origin) return;\r\n\r\n                const msg: Com.IMsgData = ev.data;\r\n                // Com.Log('.');\r\n                // Com.Log(`'message'`, msg);\r\n                // await new Promise( r => setTimeout(r, 2000) );\r\n                if(this._origin === undefined && msg.__Designhubz && msg.__type === Com.MsgType.Init)\r\n                {\r\n                    if(typeof msg.__details !== 'string') throw new Error('Com Init error: invalid origin');\r\n                    this._origin = msg.__details;\r\n\r\n                    const request: Com.IInitRequest = {\r\n                        __type: Com.MsgType.Init,\r\n                        __details: window.location.origin\r\n                    };\r\n                    this.SendMsg(request);\r\n                    Com.Log('initialized and paired to ' + this._origin);\r\n                    initResolver(); \r\n                }\r\n                else if(ev.origin === this._origin)\r\n                {\r\n                    if(msg.__Designhubz) await this.ProcessMsgAsync(ev.data);\r\n                }\r\n            });\r\n\r\n        });\r\n\r\n        if(onError !== undefined)\r\n        {\r\n            window.addEventListener('messageerror', ev => {\r\n                if(this._origin === undefined || origin === this._origin) onError(ev);\r\n            });\r\n        }\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        // Com.Log(`'ProcessMsgAsync'`, JSON.parse(JSON.stringify(msg)));\r\n        if(msg.__Designhubz !== true) throw new Error('Invalid msg: ' + msg.__type);\r\n\r\n        const streamMsg = msg as Com.IStreamMsgData;\r\n        if(typeof streamMsg.__streamId === 'string')\r\n        {\r\n            // Com.Log('Stream', streamMsg);\r\n            const streamCallback = this._streams.get(streamMsg.__streamId);\r\n            if (streamCallback !== undefined)\r\n            {\r\n                if(streamMsg.__completed === true) this._streams.delete(streamMsg.__streamId);\r\n                streamCallback(msg);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        const progressResponseMsg = msg as Com.IProgressResponse;\r\n        if(Com.IsProgressResponse(progressResponseMsg))\r\n        {\r\n            // Com.Log('Response', progressResponseMsg);\r\n            const progress = Com.GetProgress(progressResponseMsg.__details.id);\r\n            progress.Update(progressResponseMsg.__details);\r\n            return true;\r\n        }\r\n\r\n        const progressRequestMsg = msg as Com.IProgressRequest;\r\n        if(Com.IsProgressRequest(progressRequestMsg))\r\n        { \r\n            // Com.Log('Request', progressRequestMsg);\r\n            const progress = Com.GetProgress(progressRequestMsg.__details.id);\r\n            const callback = (data: Com.IProgressData) => {\r\n                if(data.id !== progressRequestMsg.__details.id) throw new Error(`Progress routing error: callback id '${data.id}' != '${progressRequestMsg.__details.id}'`);\r\n                const response: Com.IProgressResponse = {\r\n                    __type: Com.MsgType.Progress,\r\n                    __details: data\r\n                };\r\n                this.SendMsg(response);\r\n                if(data.completed === true && progressRequestMsg.__details.autoRemove === true)\r\n                {\r\n                    progress.RemoveCallback(callback);\r\n                }\r\n            };\r\n\r\n            progress.AddCallback(callback);\r\n            if(progress.data.completed === true) callback(progress.data);\r\n        }\r\n\r\n        const resolver = this._pending.get(msg.__id);\r\n        if (resolver !== undefined)\r\n        {\r\n            this._pending.delete(msg.__id);\r\n            resolver(msg);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    protected SendMsg(msg: Com.IExternalMsg, transfer?: Transferable[]): Com.IMsgData\r\n    {\r\n        if(transfer !== undefined) throw new Error('Had issues with Transferable ImageData: Impl. not tested');\r\n\r\n        const message = Object.assign({\r\n            __Designhubz: true,\r\n            __id: this._id++\r\n        }, msg) as Com.IMsgData;\r\n        return message;\r\n    }\r\n\r\n    protected async SendMsgAsync<T extends Com.IExternalMsg>(msg: Com.IExternalMsg, transfer?: Transferable[]): Promise<T>\r\n    {\r\n        return new Promise( r => {\r\n            const message = this.SendMsg(msg, transfer);\r\n            this._pending.set(message.__id, r);\r\n        });\r\n    }\r\n\r\n    // protected async StartStreamAsync<T extends Com.IExternalMsg>(msg: Com.IExternalMsg, handler: (arg: T) => void, transfer?: Transferable[]): Promise<void>\r\n    // {\r\n    //     return new Promise( r => {\r\n    //         const message = this.SendMsg(Object.assign({\r\n    //             __completed: false,\r\n    //             __streamId: 's:' + this._id\r\n    //         }, msg), transfer) as Com.IStreamMsgData;\r\n    //         this._streams.set(message.__streamId, handler);\r\n    //         this._pending.set(message.__id, r);\r\n    //     });\r\n    // }\r\n\r\n    // #region progress\r\n\r\n    public TrackProgress(id: string, onProgress: Com.TProgressCallback, autoRemove = true)\r\n    {\r\n        const request: Com.IProgressRequest = {\r\n            __type: Com.MsgType.Progress,\r\n            __details: {\r\n                id,\r\n                autoRemove\r\n            }\r\n        };\r\n\r\n        const callback: Com.TProgressCallback = data => {\r\n            if(data.id !== id) throw new Error(`Progress routing error: received id '${data.id}' != '${id}'`);\r\n            if(data.error !== undefined && typeof data.error !== 'string') console.warn('Invalid progress error', data);\r\n            onProgress(data);\r\n        };\r\n\r\n        const progress = Com.GetProgress(id);\r\n        progress.AddCallback(callback);\r\n\r\n        this.SendMsg(request);\r\n    }\r\n\r\n    public TrackProgressBundle(ratios: Record<string, number>, onProgress: Com.TProgressCallback, autoRemove = true)\r\n    {\r\n        let ratiosSum = 0;\r\n        const bundle = Object.keys(ratios).map( id => {\r\n            ratiosSum += ratios[id];\r\n            return {\r\n                id,\r\n                ratio: ratios[id],\r\n                completed: false,\r\n                progress: 0,\r\n                error: undefined as (string | undefined)\r\n            };\r\n        });\r\n\r\n        if(ratiosSum > 1 + Number.EPSILON) throw new RangeError('Progress bundle ratios over 1');\r\n\r\n        const bundleData: IternallyMutable<Com.IProgressData> = {\r\n            id: 'bundle',\r\n            completed: false,\r\n            progress: 0\r\n        };\r\n\r\n        const update = () => {\r\n            bundleData.completed = true;\r\n            bundleData.progress = 0;\r\n            delete bundleData.error;\r\n            for(let i = 0; i < bundle.length; i++)\r\n            {\r\n                const entry = bundle[i];\r\n                bundleData.completed = bundleData.completed && entry.completed;\r\n                bundleData.progress += entry.progress * entry.ratio;\r\n                if(typeof entry.error === 'string') bundleData.error = entry.error;\r\n            }\r\n            if(bundleData.progress < 0 || bundleData.progress > 1)\r\n            {\r\n                const bundleIds = bundle.map( e => e.id ).join(', ');\r\n                const bundleProgress = bundleData.progress.toString();\r\n                throw new Error(`Bundle progress range error:\\n[${bundleIds}] > ${bundleProgress}`);\r\n            }\r\n            onProgress(bundleData);\r\n        };\r\n\r\n        bundle.forEach( entry => {\r\n            this.TrackProgress(entry.id, data => {\r\n                entry.completed = data.completed;\r\n                entry.progress = data.progress;\r\n                if(typeof data.error === 'string') entry.error = data.error;\r\n                update();\r\n            }, autoRemove);\r\n        });\r\n    }\r\n\r\n    private static _progress: Record<string, Com.ProgressObject> = {};\r\n\r\n    public static GetProgress(id: string): Com.ProgressObject\r\n    {\r\n        if(this._progress[id] === undefined)\r\n        {\r\n            const data: Com.IProgressData = {\r\n                id,\r\n                completed: false,\r\n                progress: 0\r\n            };\r\n            this._progress[id] = new Com.ProgressObject(data);\r\n        }\r\n        return this._progress[id];\r\n    }\r\n\r\n    public static StartProgress(id: string): Com.ProgressObject\r\n    {\r\n        const progress = this.GetProgress(id);\r\n        const data: IternallyMutable<Com.IProgressData> = progress.data;\r\n        data.completed = false;\r\n        data.progress = 0;\r\n        delete data.error;\r\n        return this._progress[id];\r\n    }\r\n}\r\n\r\nexport namespace Com\r\n{\r\n    export function Log(...args: Parameters<typeof console.log>)\r\n    {\r\n        args.unshift(`[${Com.source}]`);\r\n        console.log(...args);\r\n    }\r\n\r\n    export async function MockProgress(id: string, notifications: number, duration: number, injectErr?: {error?: string})\r\n    {\r\n        const loadProgress = Com.StartProgress(id);\r\n\r\n        let updates = 0;\r\n        let iid = setInterval( () => {\r\n            loadProgress.Update(updates === notifications, updates / notifications, injectErr?.error);\r\n            if(updates === notifications) clearInterval(iid);\r\n            else updates++;\r\n        }, duration / notifications);\r\n    }\r\n\r\n    export function IsProgressRequest(msg: Com.IExternalMsg): msg is Com.IProgressRequest\r\n    {\r\n        const m = msg as Com.IProgressRequest;\r\n        const d = m.__details;\r\n        if(m.__type === Com.MsgType.Progress && d && typeof d.id === 'string') return true;\r\n        return false;\r\n    }\r\n\r\n    export function IsProgressResponse(msg: Com.IExternalMsg): msg is Com.IProgressResponse\r\n    {\r\n        const m = msg as Com.IProgressResponse;\r\n        const d = m.__details;\r\n        if(m.__type === Com.MsgType.Progress && d \r\n            && typeof d.id === 'string'\r\n            && typeof d.progress === 'number'\r\n            && typeof d.completed === 'boolean'\r\n        ) return true;\r\n        return false;\r\n    }\r\n\r\n    export class ProgressObject\r\n    {\r\n        private _shouldBroadcast = false;\r\n        private _callbacks: Com.TProgressCallback[] = [];\r\n\r\n        constructor(public readonly data: Com.IProgressData)\r\n        {}\r\n\r\n        public AddCallback(callback: Com.TProgressCallback)\r\n        {\r\n            if(typeof callback !== 'function')\r\n            {\r\n                console.warn('Not a function', callback);\r\n                throw(\"'callback' should be a function.\");\r\n            }\r\n            this._callbacks.push(callback);\r\n        }\r\n\r\n        public RemoveCallback(callback: Com.TProgressCallback)\r\n        {\r\n            const index = this._callbacks.indexOf(callback);\r\n            if(index !== -1) this._callbacks.splice(index, 1);\r\n        }\r\n\r\n        public Update(data: Com.IProgressData): void\r\n        public Update(completed?: boolean, progress?: number, error?: string): void\r\n        public Update(param0?: boolean | Com.IProgressData, progress?: number, error?: string): void\r\n        {\r\n            let completed = param0;\r\n            if(param0 !== undefined && typeof param0 !== 'boolean')\r\n            {\r\n                completed = param0.completed;\r\n                progress = param0.progress;\r\n                error = param0.error;\r\n            }\r\n\r\n            const data: IternallyMutable<Com.IProgressData> = this.data;\r\n            if(typeof completed === 'boolean') data.completed = completed;\r\n            if(typeof progress === 'number')\r\n            {\r\n                if(data.progress < 0 || data.progress > 1)\r\n                    throw new RangeError(`Progress out of range: ${data.id} > ${data.progress.toString()}`);\r\n                data.progress = progress;\r\n            }\r\n            if(typeof error === 'string') data.error = error;\r\n\r\n            // throttle updates\r\n            this._shouldBroadcast = true;\r\n            requestAnimationFrame( () => {\r\n                if(this._shouldBroadcast)\r\n                {\r\n                    this._shouldBroadcast = false;\r\n                    this.Broadcast(this.data);\r\n                }\r\n            });\r\n        }\r\n\r\n        private Broadcast(arg: Com.IProgressData)\r\n        {\r\n            // Com.Log('Broadcast:', arg);\r\n            for(let i = 0; i < this._callbacks.length; i++) this._callbacks[i](arg);\r\n        }\r\n    }\r\n}\r\n","// Original source in @designhubz-widget\r\nimport { Com } from './Com';\r\n\r\nexport type TProgressCallback = (progress: number) => void;\r\n\r\nexport enum WidgetMsgType\r\n{\r\n    Snapshot = 'Snapshot',\r\n    Save = 'Save',\r\n    Debug = 'Debug',\r\n    Load = 'Load',\r\n    LoadVariation = 'LoadVariation',\r\n    TrackingStatusChange = 'TrackingStatusChange',\r\n    EyewearFit = 'EyewearFit'\r\n}\r\n\r\nexport namespace Progress\r\n{\r\n    export namespace ID\r\n    {\r\n        export const load = () => 'load';\r\n        export const assets = () => 'assets';\r\n        export const scene = (workspaceKey: string, productKey: string) => `LoadScene(${workspaceKey}, ${productKey})`;\r\n    }\r\n}\r\n\r\nexport namespace Editor\r\n{\r\n    export enum Mode\r\n    {\r\n        Default = 'default',\r\n        Export = 'export',\r\n        Geometry = 'geometry',\r\n        Variation = 'variation'\r\n    }\r\n}\r\n\r\nexport namespace Eyewear\r\n{\r\n    export const enum MsgType {\r\n        Idle = 'Idle',\r\n        CameraNotFound = 'CameraNotFound',\r\n        FaceNotFound = 'FaceNotFound',\r\n        Analyzing = 'Analyzing',\r\n        Tracking = 'Tracking'\r\n    }\r\n\r\n    export interface IStatusChangeNotification extends Com.IExternalMsg\r\n    {\r\n        __type: WidgetMsgType.TrackingStatusChange;\r\n        __details: {\r\n            status: MsgType;\r\n        };\r\n    }\r\n\r\n    export interface IEyewearFitRequest extends Com.IExternalMsg\r\n    {\r\n        __type: WidgetMsgType.EyewearFit;\r\n        __details: void;\r\n    }\r\n\r\n    export interface IEyewearFitResponse extends Com.IExternalMsg\r\n    {\r\n        __type: WidgetMsgType.EyewearFit;\r\n        __details: {\r\n            value: boolean;\r\n        };\r\n    }\r\n}\r\n\r\nexport interface ILoadVariationRequest extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.LoadVariation;\r\n    __details: {\r\n        workspaceKey: string;\r\n        productKey: string;\r\n    };\r\n}\r\n\r\nexport interface ILoadVariationResponse extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.LoadVariation;\r\n    __details: {\r\n        error?: string;\r\n    };\r\n}\r\n\r\nexport interface ISnapshotRequest extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Snapshot;\r\n    __details: {\r\n        flip: boolean;\r\n    };\r\n}\r\n\r\nexport interface ISnapshotResponse extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Snapshot;\r\n    __details: ImageData;\r\n}\r\n\r\nexport interface ISaveRequest extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Save;\r\n}\r\n\r\nexport interface ISaveResponse extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Save;\r\n    __details: boolean;\r\n}\r\n","import { IWidgetData, IViewerData, IEditorData } from './Data';\r\nexport * from './Data';\r\n\r\nimport * as _Storage from './Storage';\r\nexport import Storage = _Storage;\r\n\r\nexport * from './Com';\r\n\r\nimport * as _WidgetTypes from './WidgetTypes';\r\nexport import WidgetTypes = _WidgetTypes;\r\n\r\nimport * as _Internal from './Internal';\r\nexport import Internal = _Internal;\r\n\r\nexport let widget: IWidgetData;\r\nexport let viewer: IViewerData;\r\nexport let editor: IEditorData;\r\n\r\nexport function SetWidgetSource(value: IWidgetData)\r\n{\r\n    widget = value;\r\n}\r\nexport function SetViewerSource(value: IViewerData)\r\n{\r\n    viewer = value;\r\n    SetWidgetSource(value);\r\n}\r\nexport function SetEditorSource(value: IEditorData)\r\n{\r\n    editor = value;\r\n    SetViewerSource(value);\r\n}\r\n","import { IWidgetData, IViewerData, IEditorData, Storage, Errors } from '../data';\r\n\r\nconst searchParams = (new URL(window.location.href)).searchParams;\r\nconst local = Boolean(searchParams.get('local'));\r\nconst s3 = 'https://designhubz-viewer-data.s3-eu-west-1.amazonaws.com/';\r\nconst rootUrl = local ? 'https://localhost:2020/example/storage.ignore/' : s3;\r\nconst contentUrl = local ? 'https://localhost:2020/example/storage.ignore/content/' : s3 + 'content/';\r\n\r\n// const s3Apps = 'https://dg0iszzfyf3bz.cloudfront.net/';\r\nconst s3Apps = 'https://designhubz-viewer-data.s3-eu-west-1.amazonaws.com/apps/';\r\nconst extendsFlags = local ? '?local=1' : '?';\r\nconst appsUrls = {\r\n    viewer: (local ? 'https://localhost:2020/example/' : s3Apps + 'index.html') + extendsFlags,\r\n    editor: (local ? 'https://localhost:2020/example/editor.html' : s3Apps + 'editor.html') + extendsFlags,\r\n    digitization: (local ? 'https://localhost:2020/example/digitization.html' : s3Apps + 'digitization.html') + extendsFlags,\r\n    eyewear: (local ? 'https://localhost:2030/' : s3Apps + 'eyewear/index.html') + extendsFlags,\r\n    // eyewear: (local ? 'https://localhost:2030/' : s3Apps) + extendsFlags\r\n};\r\n\r\nconst blobToBuffer = (blob: Blob) => new Response(blob).arrayBuffer();\r\n\r\nconst fetchJSON = async (url: string) => {\r\n    try\r\n    {\r\n        const response = await fetch(url, { method: 'GET' });\r\n        return response.ok ? await response.json() : undefined;\r\n    }\r\n    catch(err)\r\n    {\r\n        console.warn(err);\r\n        return undefined;\r\n    }\r\n};\r\n// #endregion\r\n\r\n// https://designhubz-viewer-data.s3-eu-west-1.amazonaws.com/user/workspace/eyewear/glass1/scene.json\r\nconst folder = {\r\n    w: (workspaceKey: string) => `${rootUrl}user/workspace/${workspaceKey}/`,\r\n    s: (workspaceKey: string, productKey: string) => `${folder.w(workspaceKey)}scene/${productKey}/`,\r\n    sk: (workspaceKey: string) => `${folder.w(workspaceKey)}skin/`,\r\n    f: (publicFolderUrl: string) => publicFolderUrl.slice(rootUrl.length),\r\n    p: (workspaceKey: string) => `${folder.w(workspaceKey)}productData/`,\r\n    d: (workspaceKey: string) => `${folder.w(workspaceKey)}digitization/`,\r\n    a: () => `${rootUrl}user/sessions/`,\r\n    st: (path: string) => `storage.ignore/${folder.f(path)}`,\r\n    c: (url: string) => `${contentUrl}${url}`\r\n};\r\n\r\n// #region mock server interface (./publish/example/remote/server.js)\r\nconst serverUrl = 'http://127.0.0.1:8082/';\r\nasync function deleteAsync(path: string): Promise<void>\r\n{\r\n    let url = `${serverUrl}?path=${escape(folder.st(path))}`;\r\n    await fetch(url, { method: 'DELETE' });\r\n}\r\n\r\nasync function storeAsync(path: string, asset: ArrayBuffer | string): Promise<void>\r\n{\r\n    let url = `${serverUrl}?path=${escape(folder.st(path))}`;\r\n    await fetch(url, {\r\n        method: 'POST', \r\n        body: asset\r\n    });\r\n}\r\n// #endregion\r\n\r\nconst buildAppUrl = (url: string, params?: {}) => {\r\n    if(params !== undefined)\r\n    {\r\n        for(const key in params)\r\n        {\r\n            const value = (params as any)[key];\r\n            if(typeof value === 'string' && value !== 'undefined') url += `&${key}=${value}`;\r\n        }\r\n    }\r\n    return url;\r\n};\r\nconst widgetApps = {\r\n    viewer: (workspaceId?: string, referenceId?: string) => buildAppUrl(appsUrls.viewer, {workspaceId, referenceId}),\r\n    eyewear: (workspaceId?: string, referenceId?: string) => buildAppUrl(appsUrls.eyewear, {workspaceId, referenceId})\r\n};\r\n\r\nclass WidgetData implements IWidgetData\r\n{\r\n    readonly apps = widgetApps;\r\n\r\n    async FetchClientConfig(): Promise<Storage.IClientConfig>\r\n    {\r\n        return {\r\n            workspaces: {\r\n                '3D': 'eyewear',\r\n                'Eyewear': 'eyewear',\r\n                'Makeup': 'makeup'\r\n            }\r\n        };\r\n    }\r\n\r\n    async FetchProduct(workspaceId: string, referenceId: string, collectVariationDetails = true): Promise<Storage.IProduct>\r\n    {\r\n        const path = folder.p(workspaceId);\r\n        const product: Storage.IProduct = await fetchJSON(path + referenceId + '.json');\r\n        if(product === undefined) throw new Errors.NotFoundError();\r\n        return product;\r\n    }\r\n\r\n    async FetchProducts(workspaceId: string, referenceIdArray: string[], collectVariationDetails: boolean): Promise<Record<string, Storage.IProduct>>\r\n    {\r\n        const fetchUtil = async (id: string) => {\r\n            try\r\n            {\r\n                const product = await this.FetchProduct(workspaceId, id, collectVariationDetails);\r\n                return product;\r\n            }\r\n            catch(err)\r\n            {\r\n                if((err instanceof Errors.NotFoundError) === false) throw err;\r\n            }\r\n            return undefined;\r\n        };\r\n\r\n        const map: Record<string, Storage.IProduct> = {};\r\n        const products = await Promise.all(referenceIdArray.map(fetchUtil));\r\n        products.forEach( product => {\r\n            if(product !== undefined) map[product.referenceId] = product\r\n        });\r\n        \r\n        return map;\r\n    }\r\n\r\n    async FetchSession(sessionId: string): Promise<Storage.Input.ISessionData>\r\n    {\r\n        const path = folder.a();\r\n        const session: Storage.Input.ISessionData = await fetchJSON(path + sessionId + '.json');\r\n        if(session === undefined) throw new Errors.NotFoundError();\r\n        return session;\r\n    }\r\n    async CreateSession(workspaceId: string, referenceId: string, userId: string): Promise<string>\r\n    {\r\n        const sessionId = `${workspaceId}-${referenceId}-${userId}-${Date.now()}`;\r\n        return sessionId;\r\n    }\r\n    async UpdateSession(sessionId: string, data: Storage.Input.ISessionData): Promise<void>\r\n    {\r\n        const path = folder.a();\r\n        await storeAsync(path + sessionId + '.json', JSON.stringify(data));\r\n    }\r\n}\r\n\r\ninterface IMockScene extends Omit<Storage.IScene, 'publicFolderUrl'>\r\n{\r\n    _assetsUrls: Storage.IAssetUrl[];\r\n}\r\n\r\ninterface IMockSkin extends Omit<Storage.ISkin, 'publicFolderUrl'>\r\n{\r\n    _assetsUrls: Storage.IAssetUrl[];\r\n}\r\n\r\nconst resolveUrls = (publicFolderUrl: string, assetsUrls: Storage.IAssetUrl[]) => { \r\n    assetsUrls.forEach( v => (v as any).url = `${rootUrl}${publicFolderUrl}${v.name}` );\r\n};\r\n\r\nclass ViewerData extends WidgetData implements IViewerData\r\n{\r\n    async FetchScene(workspaceId: string, referenceId: string): Promise<Storage.IScene>\r\n    {\r\n        const path = folder.s(workspaceId, referenceId);\r\n        const scene: IMockScene = await fetchJSON(path + 'scene.json');\r\n        if(scene === undefined) throw new Errors.NotFoundError();\r\n        scene._assetsUrls = JSON.parse(JSON.stringify(scene.assetsUrls));\r\n        const publicFolderUrl = folder.f(path);\r\n        resolveUrls(publicFolderUrl, scene.assetsUrls);\r\n        return Object.assign({\r\n            publicFolderUrl: publicFolderUrl\r\n        }, scene);\r\n    }\r\n    async FetchSkin(workspaceId: string): Promise<Storage.ISkin>\r\n    {\r\n        const path = folder.w(workspaceId);\r\n        const skin: IMockSkin = await fetchJSON(path + 'skin.json');\r\n        if(skin === undefined) throw new Errors.NotFoundError();\r\n        skin._assetsUrls = JSON.parse(JSON.stringify(skin.assetsUrls));\r\n        const publicFolderUrl = folder.f(path);\r\n        resolveUrls(publicFolderUrl, skin.assetsUrls);\r\n        return Object.assign({\r\n            publicFolderUrl: publicFolderUrl\r\n        }, skin);\r\n    }\r\n}\r\n\r\nconst editorApps = Object.assign({\r\n    editor: (params?: {}) => buildAppUrl(appsUrls.editor, params),\r\n    digitization: (params?: {}) => buildAppUrl(appsUrls.digitization, params)\r\n}, widgetApps);\r\n\r\nexport class MockData extends ViewerData implements IEditorData\r\n{\r\n    readonly apps = editorApps;\r\n\t\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t\tconsole.log('MockData');\r\n\t}\r\n\r\n    async CreateScene(workspaceId: string, referenceId: string, name: string, sceneData?: Storage.Input.TJSON, files?: Storage.Input.IUploadAsset[]): Promise<Storage.IScene>\r\n    {\r\n        try\r\n        {\r\n            const oldScene = await this.FetchScene(workspaceId, referenceId);\r\n            console.warn('Scene already exists, will update...');\r\n            return await this.UpdateScene(workspaceId, referenceId, {\r\n                deleteFiles: oldScene.assetsUrls.map( asset => asset.name ),\r\n                name: name,\r\n                files: files,\r\n                sceneData: sceneData\r\n            });\r\n        }\r\n        catch(err)\r\n        {\r\n            if(err instanceof Errors.NotFoundError)\r\n            {\r\n                // Expected: Scene does not exist yet\r\n            }\r\n            else\r\n            {\r\n                throw err;\r\n            }\r\n        }\r\n\r\n        const path = folder.s(workspaceId, referenceId);\r\n\r\n        const assetsUrls: {name: string, url: string}[] = [];\r\n        if(files !== undefined) await Promise.all( files.map( async file => {\r\n            assetsUrls.push({\r\n                name: file.name,\r\n                url: file.name\r\n            });\r\n            return storeAsync(path + file.name, await blobToBuffer(file.content));\r\n        }));\r\n        \r\n        const scene: IMockScene = {\r\n            _assetsUrls: assetsUrls,\r\n            assetsUrls: assetsUrls,\r\n            createdAt: Date.now(),\r\n            isActive: false,\r\n            name: name,\r\n            sceneData: sceneData,\r\n            referenceId: referenceId,\r\n            workspaceId: workspaceId\r\n        };\r\n\r\n        let store: Storage.IScene | undefined;\r\n        while(store === undefined)\r\n        {\r\n            try\r\n            {\r\n                await storeAsync(path + 'scene.json', JSON.stringify(scene));\r\n                await new Promise( r => setTimeout(r, 1000) );\r\n                store = await this.FetchScene(workspaceId, referenceId);\r\n            }\r\n            catch(err)\r\n            {\r\n                console.log('failed to fetch scene, retrying');\r\n            }\r\n        }\r\n        return store;\r\n    }\r\n    async UpdateScene(workspaceId: string, referenceId: string, update: {\r\n        name?: string;\r\n        sceneData?: Storage.Input.TJSON;\r\n        files?: Storage.Input.IUploadAsset[],\r\n        deleteFiles?: string[]\r\n    }): Promise<Storage.IScene>\r\n    {\r\n        let scene = await this.FetchScene(workspaceId, referenceId);\r\n        if(update.name !== undefined) (scene as any).name = update.name;\r\n\r\n        const path = folder.s(workspaceId, referenceId);\r\n        const assetsUrls: IMockScene['_assetsUrls'] = (scene as any)._assetsUrls;\r\n        if(update.deleteFiles !== undefined)\r\n        {\r\n            await Promise.all( update.deleteFiles.map( filename => {\r\n                const i = assetsUrls.findIndex( v => v.name === filename );\r\n                if(i !== -1) assetsUrls.splice(i, 1);\r\n                return deleteAsync(path + filename);\r\n            }));\r\n        }\r\n        if(update.files !== undefined)\r\n        {\r\n            await Promise.all( update.files.map( async file => {\r\n                assetsUrls.push({\r\n                    name: file.name,\r\n                    url: file.name\r\n                });\r\n                return storeAsync(path + file.name, await blobToBuffer(file.content));\r\n            }));\r\n        }\r\n        if(update.sceneData !== undefined) (scene as any).sceneData = update.sceneData;\r\n        (scene as any).assetsUrls = assetsUrls;\r\n\r\n        await storeAsync(path + 'scene.json', JSON.stringify(scene));\r\n        return this.FetchScene(workspaceId, referenceId);\r\n    }\r\n    async DeleteScene(workspaceId: string, referenceId: string): Promise<void>\r\n    {\r\n        const scene = await this.FetchScene(workspaceId, referenceId);\r\n        const path = folder.s(workspaceId, referenceId);\r\n        await deleteAsync(path);\r\n    }\r\n\r\n    async UploadSceneAssets(workspaceId: string, referenceId: string, files: Storage.Input.IUploadAsset[]): Promise<Storage.IScene>\r\n    {\r\n        return this.UpdateScene(workspaceId, referenceId, {files: files});\r\n    }\r\n    async DeleteSceneAssets(workspaceId: string, referenceId: string, names: string[]): Promise<Storage.IScene>\r\n    {\r\n        return this.UpdateScene(workspaceId, referenceId, {deleteFiles: names});\r\n    }\r\n\r\n    async CreateSkin(workspaceId: string, skinData: Storage.Input.TJSON, files: Storage.Input.IUploadAsset[]): Promise<Storage.ISkin>\r\n    {\r\n        const path = folder.sk(workspaceId);\r\n\r\n        const assetsUrls: {name: string, url: string}[] = [];\r\n        if(files !== undefined) await Promise.all( files.map( async file => {\r\n            assetsUrls.push({\r\n                name: file.name,\r\n                url: file.name\r\n            });\r\n            return storeAsync(path + file.name, await blobToBuffer(file.content));\r\n        }));\r\n        \r\n        const skin: IMockSkin = {\r\n            _assetsUrls: assetsUrls,\r\n            assetsUrls: assetsUrls,\r\n            createdAt: Date.now(),\r\n            isActive: false,\r\n            skinData: skinData,\r\n            workspaceId: workspaceId\r\n        };\r\n        await storeAsync(path + 'skin.json', JSON.stringify(skin));\r\n\r\n        return this.FetchSkin(workspaceId);\r\n    }\r\n    async DeleteSkin(workspaceId: string): Promise<void>\r\n    {\r\n        const skin = await this.FetchSkin(workspaceId);\r\n        const path = folder.sk(workspaceId);\r\n        await deleteAsync(path);\r\n    }\r\n\r\n    async FetchDigitization(workspaceId: string, modelCode: string): Promise<Storage.IDigitization>\r\n    {\r\n        const path = folder.d(workspaceId);\r\n        const digitization: Storage.IDigitization = await fetchJSON(path + modelCode + '.json');\r\n        if(digitization === undefined) throw new Errors.NotFoundError();\r\n        return digitization;\r\n    }\r\n\r\n    async FetchContent<T>(url: string): Promise<{publicFolderUrl: string, content: T}>\r\n    {\r\n        const path = folder.c(url);\r\n        const content = await fetchJSON(path + '.json');\r\n        if(content === undefined) throw new Errors.NotFoundError();\r\n        const urlParts = path.split('/');\r\n        if(urlParts[urlParts.length - 1] !== '/')\r\n        {\r\n            urlParts.pop();\r\n            urlParts.push('');\r\n        }\r\n        \r\n        const publicFolderUrl = urlParts.join('/');\r\n        return {\r\n            publicFolderUrl: publicFolderUrl,\r\n            content\r\n        };\r\n    }\r\n}\r\n","// Original source in @designhubz-widget\r\nimport { Com } from '../data/Com';\r\n\r\nexport class InlineFrame extends Com\r\n{\r\n    public async ConnectToContainer()\r\n    {\r\n        await this.SendMsgAsync<Com.IInitResponse>({ __type: Com.MsgType.Init, __details: window.location.origin });\r\n    }\r\n\r\n    protected SendMsg(msg: Com.IExternalMsg, transfer?: Transferable[]): Com.IMsgData\r\n    {\r\n        // console.log(`[InlineFrame]`, JSON.parse(JSON.stringify(msg)));\r\n        const message = super.SendMsg(msg, transfer);\r\n        if(!parent) throw new Error(`Can't query parent window.`);\r\n\r\n        const origin = this._origin ?? '*';\r\n        if(transfer !== undefined) parent.postMessage(message, origin, transfer);\r\n        else parent.postMessage(message, origin, transfer);\r\n        return message;\r\n    }\r\n}\r\n\r\nexport class IframeContext extends InlineFrame\r\n{\r\n    constructor(private readonly _processMsgAsync: InlineFrame['ProcessMsgAsync'])\r\n    {\r\n        super();\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        let resolved = await super.ProcessMsgAsync(msg);\r\n        resolved = (await this._processMsgAsync(msg)) || resolved; \r\n        return resolved;\r\n    }\r\n\r\n    public Send<T extends Com.IExternalMsg>(msg: T)\r\n    {\r\n        return this.SendMsg(msg);\r\n    }\r\n\r\n    public async SendAsync<T extends Com.IExternalMsg>(msg: Com.IExternalMsg)\r\n    {\r\n        return this.SendMsgAsync<T>(msg);\r\n    }\r\n}\r\n\r\nexport class InlineFrameContainer extends Com\r\n{\r\n    constructor(protected readonly iframe: HTMLIFrameElement)\r\n    {\r\n        super();\r\n    }\r\n\r\n    protected SendMsg(msg: Com.IExternalMsg, transfer?: Transferable[]): Com.IMsgData\r\n    {\r\n        const message = super.SendMsg(msg, transfer);\r\n        if(this.iframe.contentWindow === null) throw new Error(`Can't query iframe's contentWindow.`);\r\n\r\n        const origin = this._origin ?? '*';\r\n        if(transfer !== undefined) this.iframe.contentWindow!.postMessage(message, origin, transfer);\r\n        else this.iframe.contentWindow!.postMessage(message, origin);\r\n        return message;\r\n    }\r\n\r\n    protected Dispose()\r\n    {\r\n        if(this.iframe.parentElement !== null) this.iframe.parentElement.removeChild(this.iframe);\r\n    }\r\n}","import { Dev } from '../api';\r\n\r\nconst formatOptions = ['font-weight', 'color', 'background'];\r\n\r\nexport const _dev = new (\r\n    class _Dev implements Dev\r\n    {\r\n        public debug = false;\r\n\r\n        public Log(...args: Array<any>)\r\n        {\r\n            if(this.debug)\r\n            {\r\n                const formatting: string[] = [];\r\n                for(let i = 0; i < args.length - 1; i++)\r\n                {\r\n                    const arg = args[i];\r\n                    const text = args[i + 1];\r\n                    if(typeof arg === 'string' && typeof text === 'string' && arg.slice(0, 2) === '#(')\r\n                    {\r\n                        const optionsArgs = arg.slice(2, arg.length - 1).split(',');\r\n                        let format = formatOptions.map( (o, i) => \r\n                            typeof optionsArgs[i] === 'string' && optionsArgs[i].length > 0\r\n                                ? `${o}:${optionsArgs[i]};`\r\n                            : ''\r\n                        ).join(' ');\r\n                        \r\n                        args.splice(i, 1);\r\n                        args[i] = `%c ${text} `;\r\n                        formatting.push(format);\r\n                    }\r\n                }\r\n                if(formatting.length > 0) console.log(args.map( arg => arg.toString() ).join(''), ...formatting);\r\n                else console.log(...args);\r\n            }\r\n        }\r\n\r\n        public CreateError(name: string, message?: string)\r\n        {\r\n            this.Log(`Created ERROR '${name}': '${message}'`);\r\n            const error = new Error(message);\r\n            error.name = name;\r\n            return error;\r\n        }\r\n    }\r\n);\r\n","\r\nimport { SetEditorSource } from '../data';\r\nimport { MockData } from '../data-source';\r\nimport { _dev } from './_Dev';\r\n\r\nif(!window.location) throw new Error('Expected access to window.location');\r\nif(!('href' in window.location)) throw new Error('Expected href in window.location');\r\n\r\nSetEditorSource(new MockData());\r\n\r\n/** enabled = ?designhubz_debug=bool */\r\nexport const DEV_DEBUG_URL_PARAM = 'designhubz_debug';\r\nconst bool = (p: string | null) => p === '1' || p === 'true';\r\nconst searchParams = (new URL(window.location.href)).searchParams;\r\nif(bool(searchParams.get(DEV_DEBUG_URL_PARAM))) _dev.debug = true;\r\n","import { IProduct, IScoredRecommendation } from '../../api';\r\n\r\nexport abstract class _Product<T> implements IProduct<T>\r\n{\r\n    public readonly is3D = () => false;\r\n    public readonly isEyewear = () => false;\r\n    public readonly isMakeup = () => false;\r\n\r\n    public readonly variations: this[];\r\n\r\n    constructor(\r\n        public readonly workspaceKey: string,\r\n        public readonly productKey: string,\r\n        public readonly properties: T,\r\n        variations: _Product<T>[]\r\n    )\r\n    {\r\n        this.variations = variations as this[];\r\n    }\r\n\r\n    public get thumbnailURL(){ return ''; }\r\n\r\n    public fetchRecommendations(num: number, external?: IScoredRecommendation[]): Promise<IScoredRecommendation[]>\r\n    {\r\n        const recommendations = new Array<IScoredRecommendation>(num);\r\n        recommendations.map( (_, i) => { \r\n            return {\r\n                sku: i.toString(),\r\n                score: i / num\r\n            };\r\n        });\r\n        return new Promise( r => r(recommendations) );\r\n    }\r\n\r\n    public toJSON(): any\r\n    {\r\n        return Object.assign({}, this, {\r\n            variations: this.variations.map( v => {\r\n                const variation = Object.assign({}, v);\r\n                // @ts-ignore\r\n                delete variation.variations;\r\n                return variation;\r\n            })\r\n        })\r\n    }\r\n}\r\n","\r\nexport namespace Dom\r\n{\r\n    export function CreateStylesheet(css: string)\r\n    {\r\n        const style = document.createElement('style');\r\n        style.type = 'text/css';\r\n        style.innerHTML = css;\r\n        document.getElementsByTagName('head')[0].appendChild(style);\r\n        return style;\r\n    }\r\n\r\n    export function BuildHTML<T extends HTMLElement>(html: string): T\r\n    {\r\n        const div = document.createElement('div');\r\n        div.innerHTML = html.trim();\r\n        return div.firstChild as T;\r\n    }\r\n}\r\n","type callback<T> = (arg: T) => void;\r\n\r\nexport interface ISignal<T>\r\n{\r\n    Add(callback: callback<T>): void;\r\n    Remove(callback: callback<T>): void;\r\n    Once(callback: callback<T>): void;\r\n}\r\n\r\nexport class Signal<T> implements ISignal<T>\r\n{\r\n    public callbacks: callback<T>[];\r\n\r\n    constructor()\r\n    {\r\n        this.callbacks = [];\r\n    }\r\n\r\n    public Add(callback: callback<T>)\r\n    {\r\n        if(typeof callback !== 'function')\r\n        {\r\n            console.warn('Not a function', callback);\r\n            throw(\"'callback' should be a function.\");\r\n        }\r\n        this.callbacks.push(callback);\r\n    }\r\n\r\n    public Remove(callback: callback<T>)\r\n    {\r\n        const index = this.callbacks.indexOf(callback);\r\n        if(index !== -1) this.callbacks.splice(index, 1);\r\n    }\r\n\r\n    public Dispatch(arg: T)\r\n    {\r\n        for(let i = 0; i < this.callbacks.length; i++) this.callbacks[i](arg);\r\n    }\r\n\r\n    public Once(callback: callback<T>)\r\n    {\r\n        const once = (arg: T) => {\r\n            this.Remove(once);\r\n            callback(arg);\r\n        };\r\n        this.Add(once);\r\n    }\r\n}\r\n","console.log('@designhubz-widget/utils');\r\n\r\nexport * from './Browser';\r\nexport * from './Signals';","import { ISnapshot } from '../../api';\r\n\r\ntype TImageSource = (CanvasImageSource & {width: number, height: number}) | ImageData;\r\nlet _canvas: HTMLCanvasElement;\r\n\r\nfunction DrawToCanvas(source: TImageSource, flip: boolean)\r\n{\r\n    if(_canvas === undefined) _canvas = document.createElement('canvas');\r\n\r\n\t_canvas.width = source.width;\r\n\t_canvas.height = source.height;\r\n\r\n    const context = _canvas.getContext('2d')!;\r\n    context.resetTransform();\r\n    if(flip)\r\n    {\r\n        context.translate(0, _canvas.height);\r\n        context.scale(1, -1);\r\n    }\r\n\r\n    if(source instanceof ImageData) context.putImageData(source, 0, 0);\r\n    else context.drawImage(source, 0, 0, source.width, source.height);\r\n    return _canvas;\r\n}\r\n\r\nexport class Snapshot implements ISnapshot\r\n{\r\n    constructor(public readonly imageData: ImageData)\r\n    {}\r\n\r\n    public getDataURL(type: 'jpeg' | 'png', quality?: number)\r\n    {\r\n        const canvas =  DrawToCanvas(this.imageData, false);\r\n        return canvas.toDataURL(type === 'jpeg' ? 'image/jpeg' : 'image/png', quality)\r\n    }\r\n\r\n    public async getBlobAsync(type: 'jpeg' | 'png', quality?: number)\r\n    {\r\n        const canvas =  DrawToCanvas(this.imageData, false);\r\n        const blob = await new Promise<Blob>( (resolve, reject) => \r\n            canvas.toBlob( blob => {\r\n                if(blob === null) reject('Failed to generate Blob');\r\n                else resolve(blob);\r\n            }, type === 'jpeg' ? 'image/jpeg' : 'image/png', quality)\r\n        );\r\n\r\n        return blob;\r\n    }\r\n}\r\n","import { IWidget, IProduct, Stat, TProgressCallback } from '../../api';\r\nimport { Dom } from '../../utils';\r\nimport { _dev } from '../_Dev';\r\nimport { _Product } from '../products/_Product';\r\nimport { Snapshot } from './Snapshot';\r\nimport { InlineFrameContainer } from '../../data-source/InlineFrame';\r\nimport { Com } from '../../data/Com'; \r\nimport * as WidgetTypes from '../../data/WidgetTypes';\r\n\r\nCom.source = 'Widget';\r\n\r\nconst createIframe = () => Dom.BuildHTML<HTMLIFrameElement>(`<iframe\r\nstyle=\"width: 1px; min-width: 100%; *width: 100%; height: 1px; min-height: 100%; *height: 100%;\" \r\nwidth=\"100%\" height=\"100%\" scrolling=\"no\" frameBorder=\"0\"\r\n</iframe>`);\r\n\r\nexport abstract class _Widget<T, P extends IProduct<T>> extends InlineFrameContainer implements IWidget<T, P>\r\n{\r\n    protected _variation?: P;\r\n\r\n    constructor(public readonly domElement: HTMLDivElement)\r\n    {\r\n        super(createIframe());\r\n    }\r\n\r\n    public get variation()\r\n    {\r\n        if(this._variation === undefined) throw new Error(`Widget's variation is not ready`);\r\n        return this._variation;\r\n    }\r\n\r\n    // public async Load(progressHandler?: TProgressCallback)\r\n    // {\r\n    //     await this.waitForInit;\r\n\r\n    //     const loadId = WidgetTypes.Progress.ID.load();\r\n    //     this.TrackProgress(loadId, data => {\r\n    //         if(data.error !== undefined) throw data.error;\r\n    //         if(progressHandler !== undefined) progressHandler(data.progress);\r\n    //     });\r\n    // }\r\n\r\n    public async FirstLoadAsync(variation: P | null, progressHandler?: TProgressCallback, loadRatio = .2, sceneLoadRatio = .8)\r\n    {\r\n        await this.waitForInit;\r\n\r\n        const loadId = WidgetTypes.Progress.ID.load();\r\n        const sceneLoadId = variation === null \r\n            ? WidgetTypes.Progress.ID.assets()\r\n        : WidgetTypes.Progress.ID.scene(variation.workspaceKey, variation.productKey);\r\n\r\n        const bundleRatios = {\r\n            [loadId]: loadRatio,\r\n            [sceneLoadId]: sceneLoadRatio\r\n        };\r\n\r\n        const loadProgressAsync = new Promise<void>( resolve => {\r\n            this.TrackProgressBundle(bundleRatios, data => {\r\n                if(data.error !== undefined) throw data.error;\r\n                if(progressHandler !== undefined) progressHandler(data.progress);\r\n                if(data.completed)\r\n                {\r\n                    _dev.Log('FirstLoadAsync', data);\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n\r\n        let loadVariationAsync = variation !== null ? this.loadVariation(variation) : Promise.resolve();\r\n        await Promise.all([loadProgressAsync, loadVariationAsync]);\r\n    }\r\n\r\n    public async loadVariation(variation: P, progressHandler?: TProgressCallback)\r\n    {\r\n        // First step towards Widget then product\r\n        // if(this._variation !== undefined \r\n        //     && this._variation.variations.every( v => v.productKey !== variation.productKey )\r\n        // )\r\n        // {\r\n        //     throw new Error(`Product '${variation.productKey}' is not a variation of ${this._variation.variations.map( v => v.productKey ).join(', ')}`);\r\n        // }\r\n        \r\n        if(progressHandler !== undefined)\r\n        {\r\n            const id = WidgetTypes.Progress.ID.scene(variation.workspaceKey, variation.productKey);\r\n            this.TrackProgress(id, data => {\r\n                if(data.error !== undefined) throw data.error;\r\n                if(progressHandler !== undefined) progressHandler(data.progress);\r\n            });\r\n        }\r\n\r\n        const request: WidgetTypes.ILoadVariationRequest = {\r\n            __type: WidgetTypes.WidgetMsgType.LoadVariation,\r\n            __details: {\r\n                workspaceKey: variation.workspaceKey,\r\n                productKey: variation.productKey\r\n            }\r\n        };\r\n        \r\n        const response = await this.SendMsgAsync<WidgetTypes.ILoadVariationResponse>(request);\r\n        if(response.__details.error !== undefined) throw new Error(`Error loading variation: ${response.__details.error}`);\r\n\r\n        this._variation = variation;\r\n        _dev.Log('#(bold,#f00)', 'variation loaded:', '#()', `(${this._variation.productKey})`);\r\n    }\r\n\r\n    public async takeSnapshotAsync()\r\n    {\r\n        const request: WidgetTypes.ISnapshotRequest = {\r\n            __type: WidgetTypes.WidgetMsgType.Snapshot,\r\n            __details: {\r\n                flip: false\r\n            }\r\n        };\r\n        const response = await this.SendMsgAsync<WidgetTypes.ISnapshotResponse>(request);\r\n        const source = response.__details;\r\n        const imageData = new ImageData(new Uint8ClampedArray(source.data), source.width, source.height);\r\n        return new Snapshot(imageData);\r\n    }\r\n\r\n    public sendStat(stat: Stat)\r\n    {\r\n        return Promise.resolve();\r\n    }\r\n\r\n    public async disposeAsync()\r\n    {\r\n        this.Dispose();\r\n    }\r\n\r\n    protected SetApp(url: string)\r\n    {\r\n        if(typeof this.iframe.src === 'string' && this.iframe.src.length > 0)\r\n        {\r\n            throw new Error('Call dispose before setting iframe src again.');\r\n        }\r\n\r\n        this.iframe.src = url;\r\n\r\n        // TODO: what kind of dom events do we handle?\r\n        this.domElement.appendChild(this.iframe);\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        let resolved = await super.ProcessMsgAsync(msg);\r\n        switch(msg.__type)\r\n        {\r\n            default:\r\n                // if(resolved === false) _dev.Log(`No listeners on '${msg.__type}'`, msg);\r\n            break;\r\n        }\r\n        return resolved;\r\n    }\r\n}","import { I3DWidget } from '../../api';\r\nimport { editor as Data } from '../../data';\r\nimport { _Widget } from './_Widget';\r\nimport { _Product } from '../products/_Product';\r\nimport { _3DProduct } from '../products/_3DProduct';\r\n\r\n\r\nexport class _3DWidget<T, P extends _3DProduct<T>> extends _Widget<T, P> implements I3DWidget<T>\r\n{\r\n    public _3D = true;\r\n\r\n    constructor(\r\n        domElement: HTMLDivElement,\r\n        app?: string\r\n    ){\r\n        super(domElement);\r\n\r\n        if(app === undefined) app = Data.apps.viewer();\r\n        this.SetApp(app);\r\n    }\r\n}","import { I3DProduct, TProgressCallback } from '../../api';\r\nimport { _Product } from './_Product';\r\nimport { _3DWidget } from '../widgets/_3DWidget';\r\n\r\nexport class _3DProduct<T> extends _Product<T> implements I3DProduct<T>\r\n{\r\n    public _3D = true;\r\n    public readonly is3D = () => true;\r\n    \r\n    public async create3DWidget(domElement: HTMLDivElement, progressHandler?: TProgressCallback): Promise<_3DWidget<T, this>>\r\n    {\r\n        const widget = new _3DWidget<T, this>(domElement);\r\n        await widget.FirstLoadAsync(this, progressHandler, .2, .8);\r\n        return widget;\r\n    }\r\n}\r\n","import { IEyewearWidget, TrackingStatus } from '../../api';\r\nimport { ISignal, Signal } from '../../utils';\r\nimport { editor as Data, Com, WidgetTypes } from '../../data';\r\nimport { _dev } from '../_Dev';\r\nimport { _Widget } from './_Widget';\r\nimport { _EyewearProduct } from '../products/_EyewearProduct';\r\n\r\nexport class _EyewearWidget<T, P extends _EyewearProduct<T>> extends _Widget<T, P> implements IEyewearWidget<T>\r\n{\r\n    public _eyewear = true;\r\n    \r\n    public readonly onTrackingStatusChange: ISignal<TrackingStatus> = new Signal();\r\n    \r\n    constructor(\r\n        domElement: HTMLDivElement\r\n    ){\r\n        super(domElement);\r\n\r\n        this.iframe.setAttribute('allow', 'camera;microphone');\r\n        const app = Data.apps.eyewear();\r\n        // const app = Data.apps.viewer();\r\n        this.SetApp(app);\r\n    }\r\n\r\n    public async queryFit()\r\n    {\r\n        const request: WidgetTypes.Eyewear.IEyewearFitRequest = {\r\n            __type: WidgetTypes.WidgetMsgType.EyewearFit,\r\n            __details: void 0\r\n        };\r\n\r\n        const response = await this.SendMsgAsync<WidgetTypes.Eyewear.IEyewearFitResponse>(request);\r\n        return true;//Boolean(response.__details?.value);\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        let resolved = await super.ProcessMsgAsync(msg);\r\n        switch(msg.__type)\r\n        {\r\n            case WidgetTypes.WidgetMsgType.TrackingStatusChange: {\r\n                const details = (msg as WidgetTypes.Eyewear.IStatusChangeNotification).__details;\r\n                const status = details.status as any as TrackingStatus;\r\n                (this.onTrackingStatusChange as Signal<TrackingStatus>).Dispatch(status);\r\n                return true;\r\n            }\r\n            default:\r\n                // if(resolved === false) _dev.Log(`No listeners on '${msg.__type}'`, msg);\r\n            break;\r\n        }\r\n        return resolved;\r\n    }\r\n}","import { IEyewearProduct, TProgressCallback } from '../../api';\r\nimport { _3DProduct } from './_3DProduct';\r\nimport { _3DWidget } from '../widgets/_3DWidget';\r\nimport { _EyewearWidget } from '../widgets/_EyewearWidget';\r\n\r\nexport class _EyewearProduct<T> extends _3DProduct<T> implements IEyewearProduct<T>\r\n{\r\n    public _eyewear = true;\r\n    public _3D = true;\r\n    public readonly isEyewear = () => true;\r\n\r\n    public async createEyewearWidget(domElement: HTMLDivElement, progressHandler?: TProgressCallback): Promise<_EyewearWidget<T, this>>\r\n    {\r\n        const widget = new _EyewearWidget<T, this>(domElement);\r\n        console.log('FirstLoadAsync start');\r\n        await widget.FirstLoadAsync(this, progressHandler, .8, .2);\r\n        console.log('FirstLoadAsync end');\r\n        return widget;\r\n    }\r\n\r\n    public async createMultiWidget(domElement: HTMLDivElement, progressHandler?: TProgressCallback): Promise<any>\r\n    {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n}\r\n","import { Internal } from '../../data';\r\nimport { _Product } from './_Product';\r\nimport { _3DProduct } from './_3DProduct';\r\nimport { _EyewearProduct } from './_EyewearProduct';\r\nimport { TProps } from '../../api';\r\n\r\nconst _productsCache: Record<string, _Product<any>> = {};\r\nexport function ProductFromCache<T>(workspaceKey: string, productKey: string): _Product<T> | undefined\r\n{\r\n    return _productsCache[workspaceKey + productKey];\r\n}\r\n\r\nconst _variationsCache: Record<string, _Product<any>[]> = {};\r\nfunction VariationsFromCache<T>(workspaceKey: string, productKey: string): _Product<T>[] | undefined\r\n{\r\n    return _variationsCache[workspaceKey + productKey];\r\n}\r\n\r\nexport function ProductFromData<T extends TProps>(data: Internal.IProductData, props?: T)\r\n{\r\n    // console.log('From product data', data);\r\n    let product = ProductFromCache<T>(data.workspaceKey, data.productKey);\r\n    if(product !== undefined) return product;\r\n\r\n    let variations = VariationsFromCache<T>(data.workspaceKey, data.productKey);\r\n    if(variations === undefined)\r\n    {\r\n        variations = [];\r\n        data.variations.forEach( variation => {\r\n            if(variation.productKey !== data.productKey)\r\n            {\r\n                const vData = Object.assign({}, data, variation);\r\n                _variationsCache[vData.workspaceKey + vData.productKey] = variations!;\r\n                variations!.push(ProductFromData(vData, props));\r\n            }\r\n        });\r\n    }\r\n\r\n    if(props !== undefined)\r\n    {\r\n        let missingProps: string[] = [];\r\n        for(const key in props)\r\n        {\r\n            const header = props[key];\r\n            if(typeof header === 'string')\r\n            {\r\n                if(header in data.properties)\r\n                {\r\n                    if(key in data.properties) console.warn(`Custom property accessor '${key}' will override existing property.`);\r\n                    Object.defineProperty(data.properties, key, {\r\n                        get: () => data.properties[header]\r\n                    });\r\n                }\r\n                else \r\n                {\r\n                    missingProps.push(header);\r\n                }\r\n            }\r\n        }\r\n\r\n        if(missingProps.length > 0)\r\n        {\r\n            const plr = missingProps.length > 1;\r\n            console.warn(`Custom propert${plr ? 'ies' : 'y'}: '${missingProps.join(`', '`)}' ${plr ? 'are' : 'is'} missing from '${data.productKey}'`);\r\n        }\r\n    }\r\n\r\n    const productArgs: [string, string, T, _Product<T>[]] = [\r\n        data.workspaceKey,\r\n        data.productKey,\r\n        data.properties,\r\n        variations\r\n    ];\r\n\r\n    // console.log('productArgs', productArgs);\r\n\r\n    switch(data.productType)\r\n    {\r\n        case '3D':\r\n            product = new _3DProduct<T>(...productArgs);\r\n        break;\r\n        case 'Eyewear':\r\n            product = new _EyewearProduct<T>(...productArgs);\r\n        break;\r\n        case 'Makeup':\r\n            throw 'Makeup type not implemented';\r\n        default:\r\n            throw 'productType is undefined';\r\n    }\r\n\r\n    variations.push(product);\r\n    _productsCache[data.workspaceKey + data.productKey] = product;\r\n    return product;\r\n}\r\n","import { Storage } from '../data';\r\n\r\ninterface IConfig\r\n{\r\n    readonly workspaces: Record<Storage.TProductType, string>;\r\n}\r\n\r\nexport const configAsync: Promise<IConfig> = new Promise( (resolve, reject) => {\r\n    resolve({\r\n        workspaces: {\r\n            '3D': 'eyewear',\r\n            'Eyewear': 'eyewear',\r\n            'Makeup': 'makeup'\r\n        }\r\n    });\r\n});","import { IProduct, IEyewearProduct, IMakeupProduct, TProps,  } from '../api';\r\nimport { widget as Data, Internal } from '../data';\r\nimport { _Product } from './products/_Product';\r\nimport { ProductFromCache, ProductFromData } from './products/Factory';\r\nimport { _dev } from './_Dev';\r\nimport { configAsync } from './_Config';\r\n\r\nexport * from '../api';\r\n\r\nexport const version: string = '0.0.7';\r\n\r\nexport const dev = _dev;\r\n\r\nexport async function fetchProduct<T extends TProps>(workspaceKey: string, productKey: string, props?: T): Promise<IProduct<T>>\r\n{\r\n    if(typeof workspaceKey !== 'string' || typeof productKey !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchProduct(${workspaceKey}: string, ${productKey}: string)`);\r\n    let product = ProductFromCache<T>(workspaceKey, productKey);\r\n    if(product === undefined)\r\n    {\r\n        _dev.Log('#(bold,#f00)', 'fetching product:', '#()', `(${workspaceKey}, ${productKey})`);\r\n        const productData = await Data.FetchProduct(workspaceKey, productKey, true);\r\n        \r\n        const variations: Internal.IProductData['variations'] = [];\r\n        productData.variations.forEach( v => {\r\n            // if(v.referenceId !== productKey)\r\n            // {\r\n                variations.push({\r\n                    productKey: v.referenceId,\r\n                    name: v.name,\r\n                    properties: Object.assign({}, v.originalProperties)\r\n                });\r\n            // }\r\n        });\r\n\r\n        product = ProductFromData<T>({\r\n            workspaceKey: workspaceKey,\r\n            productKey: productKey,\r\n            name: productData.name,\r\n            productType: 'Eyewear',\r\n            properties: Object.assign({}, productData.originalProperties),\r\n            variations: variations\r\n        }, props);\r\n\r\n        // console.log('*** fetched product', JSON.parse(JSON.stringify(product)));\r\n    }\r\n    else\r\n    {\r\n        _dev.Log('#(bold,#f88)', '(cache) fetching product:', '#()', `(${workspaceKey} | ${productKey})`);\r\n    }\r\n    return product;\r\n}\r\n\r\nexport async function fetchProducts<T extends TProps>(workspaceKey: string, productKeys: string[], props?: T): Promise<Record<string, IProduct<T> | undefined>>\r\n{\r\n    if(typeof workspaceKey !== 'string' || (productKeys instanceof Array) === false || productKeys.length === 0 || typeof productKeys[0] !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchProducts(${workspaceKey}: string, ${productKeys.join(', ')}: string[])`);\r\n    \r\n    _dev.Log('#(bold,#000)', 'fetching products:', '#()', `(${workspaceKey}, [${productKeys.join(', ')}])`);\r\n\r\n    const result: Record<string, IProduct<T> | undefined> = {};\r\n    const stats = {cache: 0, fetch: 0, missing: productKeys.length};\r\n    const productsToFetch: string[] = [];\r\n    productKeys.forEach( productKey => {\r\n        const product = ProductFromCache<T>(workspaceKey, productKey);\r\n        if(product === undefined)\r\n        {\r\n            productsToFetch.push(productKey);\r\n        }\r\n        else\r\n        {\r\n            stats.cache++;\r\n            stats.missing--;\r\n            result[productKey] = product;\r\n        }\r\n    });\r\n    if(productsToFetch.length > 0)\r\n    {\r\n        const productsDataMap = await Data.FetchProducts(workspaceKey, productsToFetch, true);\r\n        productsToFetch.forEach( productKey => {\r\n            const productData = productsDataMap[productKey];\r\n            if(productData !== undefined)\r\n            {\r\n                stats.fetch++;\r\n                stats.missing--;\r\n                result[productKey] = ProductFromData<T>({\r\n                    workspaceKey: workspaceKey,\r\n                    productKey: productKey,\r\n                    name: productData.name,\r\n                    productType: 'Eyewear',\r\n                    properties: Object.assign({}, productData.originalProperties),\r\n                    variations: productData.variations.filter( v => v.referenceId !== productKey ).map( v => {\r\n                        return {\r\n                            productKey: v.referenceId,\r\n                            name: v.name,\r\n                            properties: Object.assign({}, v.originalProperties)\r\n                        };\r\n                    })\r\n                }, props);\r\n            }\r\n        });\r\n    }\r\n    _dev.Log(\r\n        '#(,#f88)', `${stats.cache} from cache`, ' | ', \r\n        stats.fetch > 0 ? '#(bold,#f00)' : '#(bold)', `${stats.fetch} fetched`, ' | ', \r\n        stats.missing > 0 ? '#(#fff,#f00)' : '#(bold)', `${stats.missing} missing`);\r\n    return result;\r\n}\r\n\r\nexport async function fetchEyewearProduct<T extends TProps>(productKey: string, props?: T): Promise<IEyewearProduct<T>>\r\n{\r\n    if(typeof productKey !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchEyewearProduct(${productKey}: string)`);\r\n    \r\n    const workspaceKey = (await configAsync).workspaces.Eyewear;\r\n    const product = await fetchProduct(workspaceKey, productKey, props);\r\n    if(product.isEyewear()) return product;\r\n    else throw new Error(`${productKey} is not of 'Eyewear' type.`);\r\n}\r\n\r\nexport async function fetchMakeupProduct<T extends TProps>(productKey: string, props?: T): Promise<IMakeupProduct<T>>\r\n{\r\n    if(typeof productKey !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchMakeupProduct(${productKey}: string)`);\r\n\r\n    const workspaceKey = (await configAsync).workspaces.Makeup;\r\n    const product = await fetchProduct(workspaceKey, productKey, props);\r\n    if(product.isMakeup()) return product;\r\n    else throw new Error(`${productKey} is not of 'Makeup' type.`);\r\n}","console.log('@designhubz-widget/lib');\r\n\r\nimport './_Data';\r\nexport * from './_API';\r\n"],"names":["searchParams","WidgetTypes.Progress","WidgetTypes.WidgetMsgType","Data"],"mappings":"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"}