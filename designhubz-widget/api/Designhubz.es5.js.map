{"version":3,"file":"Designhubz.es5.js","sources":["../src/packages/data/Data.ts","../src/packages/data/Com.ts","../src/packages/data/WidgetTypes.ts","../src/packages/data/index.ts","../src/packages/data-source/MockData.ts","../src/packages/data-source/InlineFrame.ts","../src/packages/lib/_Dev.ts","../src/packages/lib/_Data.ts","../src/packages/lib/products/_Product.ts","../src/packages/utils/Browser.ts","../src/packages/utils/Signals.ts","../src/packages/utils/index.ts","../src/packages/lib/widgets/Snapshot.ts","../src/packages/lib/widgets/_Widget.ts","../src/packages/lib/widgets/_3DWidget.ts","../src/packages/lib/products/_3DProduct.ts","../src/packages/lib/widgets/_EyewearWidget.ts","../src/packages/lib/products/_EyewearProduct.ts","../src/packages/lib/products/Factory.ts","../src/packages/lib/_Config.ts","../src/packages/lib/_API.ts","../src/packages/lib/index.ts"],"sourcesContent":["import { IProduct, IDigitization, IClientConfig, Input, IContent } from './Storage';\r\nimport { IScene, ISkin } from './Internal';\r\n\r\nclass CustomError\r\n{\r\n\tpublic name?: string;\r\n\tpublic stack?: string;\r\n\tpublic message?: string;\r\n\r\n\tconstructor(error?: string | Error) \r\n\t{\r\n\t\tlet errorObject: Error;\r\n\t\tif(error === undefined || typeof error === 'string') errorObject = new Error(error);\r\n\t\telse errorObject = error;\r\n\t\tObject.assign(this, errorObject);\r\n\t}\r\n}\r\n\r\nexport namespace Errors\r\n{\r\n    export class NotFoundError extends CustomError\r\n    {\r\n        constructor()\r\n        {\r\n            super('NotFoundError');\r\n        }\r\n    }\r\n\r\n    export class AuthenticationError extends CustomError\r\n    {\r\n        constructor()\r\n        {\r\n            super('AuthenticationError');\r\n        }\r\n    }\r\n\r\n    export type ProductData = NotFoundError | AuthenticationError;\r\n    export type Session = NotFoundError | AuthenticationError;\r\n    export type Scene = NotFoundError | AuthenticationError;\r\n    export type Skin = NotFoundError | AuthenticationError;\r\n    export type DigitizationData = NotFoundError;\r\n}\r\n\r\ninterface IWidgetApps\r\n{\r\n    viewer: (workspaceId?: string, referenceId?: string) => string;\r\n    eyewear: (workspaceKey?: string, productKey?: string) => string;\r\n}\r\n\r\nexport interface IWidgetData\r\n{\r\n    readonly apps: IWidgetApps;\r\n\r\n    FetchClientConfig(): Promise<IClientConfig>;\r\n    FetchProduct(workspaceId: string, referenceId: string, collectVariationDetails: boolean): Promise<IProduct>;\r\n    FetchProducts(workspaceId: string, referenceIdArray: string[], collectVariationDetails: boolean): Promise<Record<string, IProduct>>;\r\n    \r\n    /** @returns sessionId */\r\n    CreateSession(workspaceId: string, referenceId: string, userId: string): Promise<string>;\r\n    UpdateSession(sessionId: string, data: Input.ISessionData): Promise<void>;\r\n}\r\n\r\nexport interface IViewerData extends IWidgetData\r\n{\r\n    FetchScene(workspaceId: string, referenceId: string): Promise<IScene>;\r\n    \r\n    FetchSkin(workspaceId: string): Promise<ISkin>;\r\n}\r\n\r\ninterface IEditorApps extends IWidgetApps\r\n{\r\n    editor: (params?: {}) => string;\r\n    digitization: (params?: {}) => string;\r\n}\r\n\r\nexport interface IEditorData extends IViewerData\r\n{\r\n    readonly apps: IEditorApps;\r\n\r\n    CreateScene(workspaceId: string, referenceId: string, name: string, sceneData?: Input.TJSON, files?: Input.IUploadAsset[]): Promise<IScene>;\r\n    UpdateScene(workspaceId: string, referenceId: string, update: {\r\n        name?: string, // Not implemented server side\r\n        sceneData?: Input.TJSON\r\n    }): Promise<IScene>;\r\n    DeleteScene(workspaceId: string, referenceId: string): Promise<void>;\r\n\r\n    UploadSceneAssets(workspaceId: string, referenceId: string, files: Input.IUploadAsset[]): Promise<IScene>;\r\n    DeleteSceneAssets(workspaceId: string, referenceId: string, names: string[]): Promise<IScene>;\r\n\r\n    CreateSkin(workspaceId: string, skinData: Input.TJSON, files: Input.IUploadAsset[]): Promise<ISkin>;\r\n    DeleteSkin(workspaceId: string): Promise<void>;\r\n\r\n    FetchDigitization(workspaceId: string, modelCode: string): Promise<IDigitization>;\r\n\r\n    FetchContent(url: string): Promise<IContent>;\r\n}\r\n","// Original source in @designhubz-widget\r\n\r\ntype IternallyMutable<T> = {\r\n    -readonly [K in keyof T]: T[K] \r\n};\r\n\r\nexport declare namespace Com\r\n{\r\n    export const enum MsgType\r\n    {\r\n        Init = 'init',\r\n        Progress = 'Progress'\r\n    }\r\n\r\n    export interface IMsgData\r\n    {\r\n        __Designhubz: true;\r\n        __id: number;\r\n        __type: string;\r\n        __details?: any;\r\n    }\r\n\r\n    export interface IStreamMsgData extends IMsgData\r\n    {\r\n        __completed: boolean;\r\n        __streamId: string;\r\n    }\r\n\r\n    export interface IExternalMsg extends Omit<IMsgData, '__Designhubz' | '__id'>\r\n    {}\r\n\r\n    export interface IInitRequest extends IExternalMsg\r\n    {\r\n        __type: MsgType.Init;\r\n        /** origin */\r\n        __details: string;\r\n    }\r\n\r\n    export interface IInitResponse extends IInitRequest \r\n    {}\r\n\r\n    // #region progress\r\n\r\n    export interface IProgressData\r\n    {\r\n        readonly id: string;\r\n        /** @param progress Normalized [0, 1] progress value */\r\n        readonly progress: number;\r\n        readonly completed: boolean;\r\n        readonly error?: string;\r\n    }\r\n\r\n    export interface IProgressRequest extends Com.IExternalMsg\r\n    {\r\n        __type: MsgType.Progress;\r\n        __details: {\r\n            id: string;\r\n            autoRemove?: boolean;\r\n        };\r\n    }\r\n\r\n    export interface IProgressResponse extends Com.IExternalMsg\r\n    {\r\n        __type: MsgType.Progress;\r\n        __details: IProgressData;\r\n    }\r\n\r\n    export type TProgressCallback = (data: IProgressData) => void;\r\n}\r\n\r\nexport class Com\r\n{\r\n    public static source = 'Com';\r\n\r\n    protected readonly waitForInit: Promise<void>;\r\n\r\n    protected _origin?: string;\r\n\r\n    private _id = 0;\r\n    private _pending = new Map<number, (arg: any) => void>();\r\n    private _streams = new Map<string, (arg: any) => void>();\r\n\r\n    constructor(onError?: (ev: MessageEvent) => void)\r\n    {\r\n        this.waitForInit = new Promise<void>( initResolver => {\r\n\r\n            window.addEventListener('message', async ev => {\r\n                if(ev.origin === window.location.origin) return;\r\n\r\n                const msg: Com.IMsgData = ev.data;\r\n                // Com.Log('.');\r\n                // Com.Log(`'message'`, msg);\r\n                // await new Promise( r => setTimeout(r, 2000) );\r\n                if(this._origin === undefined && msg.__Designhubz && msg.__type === Com.MsgType.Init)\r\n                {\r\n                    if(typeof msg.__details !== 'string') throw new Error('Com Init error: invalid origin');\r\n                    this._origin = msg.__details;\r\n\r\n                    const request: Com.IInitRequest = {\r\n                        __type: Com.MsgType.Init,\r\n                        __details: window.location.origin\r\n                    };\r\n                    this.SendMsg(request);\r\n                    Com.Log('initialized and paired to ' + this._origin);\r\n                    initResolver(); \r\n                }\r\n                else if(ev.origin === this._origin)\r\n                {\r\n                    if(msg.__Designhubz) await this.ProcessMsgAsync(ev.data);\r\n                }\r\n            });\r\n\r\n        });\r\n\r\n        if(onError !== undefined)\r\n        {\r\n            window.addEventListener('messageerror', ev => {\r\n                if(this._origin === undefined || origin === this._origin) onError(ev);\r\n            });\r\n        }\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        // Com.Log(`'ProcessMsgAsync'`, JSON.parse(JSON.stringify(msg)));\r\n        if(msg.__Designhubz !== true) throw new Error('Invalid msg: ' + msg.__type);\r\n\r\n        const streamMsg = msg as Com.IStreamMsgData;\r\n        if(typeof streamMsg.__streamId === 'string')\r\n        {\r\n            // Com.Log('Stream', streamMsg);\r\n            const streamCallback = this._streams.get(streamMsg.__streamId);\r\n            if (streamCallback !== undefined)\r\n            {\r\n                if(streamMsg.__completed === true) this._streams.delete(streamMsg.__streamId);\r\n                streamCallback(msg);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        const progressResponseMsg = msg as Com.IProgressResponse;\r\n        if(Com.IsProgressResponse(progressResponseMsg))\r\n        {\r\n            // Com.Log('Response', progressResponseMsg);\r\n            const progress = Com.GetProgress(progressResponseMsg.__details.id);\r\n            progress.Update(progressResponseMsg.__details);\r\n            return true;\r\n        }\r\n\r\n        const progressRequestMsg = msg as Com.IProgressRequest;\r\n        if(Com.IsProgressRequest(progressRequestMsg))\r\n        { \r\n            // Com.Log('Request', progressRequestMsg);\r\n            const progress = Com.GetProgress(progressRequestMsg.__details.id);\r\n            const callback = (data: Com.IProgressData) => {\r\n                if(data.id !== progressRequestMsg.__details.id) throw new Error(`Progress routing error: callback id '${data.id}' != '${progressRequestMsg.__details.id}'`);\r\n                const response: Com.IProgressResponse = {\r\n                    __type: Com.MsgType.Progress,\r\n                    __details: data\r\n                };\r\n                this.SendMsg(response);\r\n                if(data.completed === true && progressRequestMsg.__details.autoRemove === true)\r\n                {\r\n                    progress.RemoveCallback(callback);\r\n                }\r\n            };\r\n\r\n            progress.AddCallback(callback);\r\n            if(progress.data.completed === true) callback(progress.data);\r\n        }\r\n\r\n        const resolver = this._pending.get(msg.__id);\r\n        if (resolver !== undefined)\r\n        {\r\n            this._pending.delete(msg.__id);\r\n            resolver(msg);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    protected SendMsg(msg: Com.IExternalMsg, transfer?: Transferable[]): Com.IMsgData\r\n    {\r\n        if(transfer !== undefined) throw new Error('Had issues with Transferable ImageData: Impl. not tested');\r\n\r\n        const message = Object.assign({\r\n            __Designhubz: true,\r\n            __id: this._id++\r\n        }, msg) as Com.IMsgData;\r\n        return message;\r\n    }\r\n\r\n    protected async SendMsgAsync<T extends Com.IExternalMsg>(msg: Com.IExternalMsg, transfer?: Transferable[]): Promise<T>\r\n    {\r\n        return new Promise( r => {\r\n            const message = this.SendMsg(msg, transfer);\r\n            this._pending.set(message.__id, r);\r\n        });\r\n    }\r\n\r\n    // protected async StartStreamAsync<T extends Com.IExternalMsg>(msg: Com.IExternalMsg, handler: (arg: T) => void, transfer?: Transferable[]): Promise<void>\r\n    // {\r\n    //     return new Promise( r => {\r\n    //         const message = this.SendMsg(Object.assign({\r\n    //             __completed: false,\r\n    //             __streamId: 's:' + this._id\r\n    //         }, msg), transfer) as Com.IStreamMsgData;\r\n    //         this._streams.set(message.__streamId, handler);\r\n    //         this._pending.set(message.__id, r);\r\n    //     });\r\n    // }\r\n\r\n    // #region progress\r\n\r\n    public TrackProgress(id: string, onProgress: Com.TProgressCallback, autoRemove = true)\r\n    {\r\n        const request: Com.IProgressRequest = {\r\n            __type: Com.MsgType.Progress,\r\n            __details: {\r\n                id,\r\n                autoRemove\r\n            }\r\n        };\r\n\r\n        const callback: Com.TProgressCallback = data => {\r\n            if(data.id !== id) throw new Error(`Progress routing error: received id '${data.id}' != '${id}'`);\r\n            if(data.error !== undefined && typeof data.error !== 'string') console.warn('Invalid progress error', data);\r\n            onProgress(data);\r\n        };\r\n\r\n        const progress = Com.GetProgress(id);\r\n        progress.AddCallback(callback);\r\n\r\n        this.SendMsg(request);\r\n    }\r\n\r\n    public TrackProgressBundle(ratios: Record<string, number>, onProgress: Com.TProgressCallback, autoRemove = true)\r\n    {\r\n        let ratiosSum = 0;\r\n        const bundle = Object.keys(ratios).map( id => {\r\n            ratiosSum += ratios[id];\r\n            return {\r\n                id,\r\n                ratio: ratios[id],\r\n                completed: false,\r\n                progress: 0,\r\n                error: undefined as (string | undefined)\r\n            };\r\n        });\r\n\r\n        if(ratiosSum > 1 + Number.EPSILON) throw new RangeError('Progress bundle ratios over 1');\r\n\r\n        const bundleData: IternallyMutable<Com.IProgressData> = {\r\n            id: 'bundle',\r\n            completed: false,\r\n            progress: 0\r\n        };\r\n\r\n        const update = () => {\r\n            bundleData.completed = true;\r\n            bundleData.progress = 0;\r\n            delete bundleData.error;\r\n            for(let i = 0; i < bundle.length; i++)\r\n            {\r\n                const entry = bundle[i];\r\n                bundleData.completed = bundleData.completed && entry.completed;\r\n                bundleData.progress += entry.progress * entry.ratio;\r\n                if(typeof entry.error === 'string') bundleData.error = entry.error;\r\n            }\r\n            if(bundleData.progress < 0 || bundleData.progress > 1)\r\n            {\r\n                const bundleIds = bundle.map( e => e.id ).join(', ');\r\n                const bundleProgress = bundleData.progress.toString();\r\n                throw new Error(`Bundle progress range error:\\n[${bundleIds}] > ${bundleProgress}`);\r\n            }\r\n            onProgress(bundleData);\r\n        };\r\n\r\n        bundle.forEach( entry => {\r\n            this.TrackProgress(entry.id, data => {\r\n                entry.completed = data.completed;\r\n                entry.progress = data.progress;\r\n                if(typeof data.error === 'string') entry.error = data.error;\r\n                update();\r\n            }, autoRemove);\r\n        });\r\n    }\r\n\r\n    private static _progress: Record<string, Com.ProgressObject> = {};\r\n\r\n    public static GetProgress(id: string): Com.ProgressObject\r\n    {\r\n        if(this._progress[id] === undefined)\r\n        {\r\n            const data: Com.IProgressData = {\r\n                id,\r\n                completed: false,\r\n                progress: 0\r\n            };\r\n            this._progress[id] = new Com.ProgressObject(data);\r\n        }\r\n        return this._progress[id];\r\n    }\r\n\r\n    public static StartProgress(id: string): Com.ProgressObject\r\n    {\r\n        const progress = this.GetProgress(id);\r\n        const data: IternallyMutable<Com.IProgressData> = progress.data;\r\n        data.completed = false;\r\n        data.progress = 0;\r\n        delete data.error;\r\n        return this._progress[id];\r\n    }\r\n}\r\n\r\nexport namespace Com\r\n{\r\n    export function Log(...args: Parameters<typeof console.log>)\r\n    {\r\n        args.unshift(`[${Com.source}]`);\r\n        console.log(...args);\r\n    }\r\n\r\n    export async function MockProgress(id: string, notifications: number, duration: number, injectErr?: {error?: string})\r\n    {\r\n        const loadProgress = Com.StartProgress(id);\r\n\r\n        let updates = 0;\r\n        let iid = setInterval( () => {\r\n            loadProgress.Update(updates === notifications, updates / notifications, injectErr?.error);\r\n            if(updates === notifications) clearInterval(iid);\r\n            else updates++;\r\n        }, duration / notifications);\r\n    }\r\n\r\n    export function IsProgressRequest(msg: Com.IExternalMsg): msg is Com.IProgressRequest\r\n    {\r\n        const m = msg as Com.IProgressRequest;\r\n        const d = m.__details;\r\n        if(m.__type === Com.MsgType.Progress && d && typeof d.id === 'string') return true;\r\n        return false;\r\n    }\r\n\r\n    export function IsProgressResponse(msg: Com.IExternalMsg): msg is Com.IProgressResponse\r\n    {\r\n        const m = msg as Com.IProgressResponse;\r\n        const d = m.__details;\r\n        if(m.__type === Com.MsgType.Progress && d \r\n            && typeof d.id === 'string'\r\n            && typeof d.progress === 'number'\r\n            && typeof d.completed === 'boolean'\r\n        ) return true;\r\n        return false;\r\n    }\r\n\r\n    export class ProgressObject\r\n    {\r\n        private _shouldBroadcast = false;\r\n        private _callbacks: Com.TProgressCallback[] = [];\r\n\r\n        constructor(public readonly data: Com.IProgressData)\r\n        {}\r\n\r\n        public AddCallback(callback: Com.TProgressCallback)\r\n        {\r\n            if(typeof callback !== 'function')\r\n            {\r\n                console.warn('Not a function', callback);\r\n                throw(\"'callback' should be a function.\");\r\n            }\r\n            this._callbacks.push(callback);\r\n        }\r\n\r\n        public RemoveCallback(callback: Com.TProgressCallback)\r\n        {\r\n            const index = this._callbacks.indexOf(callback);\r\n            if(index !== -1) this._callbacks.splice(index, 1);\r\n        }\r\n\r\n        public Update(data: Com.IProgressData): void\r\n        public Update(completed?: boolean, progress?: number, error?: string): void\r\n        public Update(param0?: boolean | Com.IProgressData, progress?: number, error?: string): void\r\n        {\r\n            let completed = param0;\r\n            if(param0 !== undefined && typeof param0 !== 'boolean')\r\n            {\r\n                completed = param0.completed;\r\n                progress = param0.progress;\r\n                error = param0.error;\r\n            }\r\n\r\n            const data: IternallyMutable<Com.IProgressData> = this.data;\r\n            if(typeof completed === 'boolean') data.completed = completed;\r\n            if(typeof progress === 'number')\r\n            {\r\n                if(data.progress < 0 || data.progress > 1)\r\n                    throw new RangeError(`Progress out of range: ${data.id} > ${data.progress.toString()}`);\r\n                data.progress = progress;\r\n            }\r\n            if(typeof error === 'string') data.error = error;\r\n\r\n            // throttle updates\r\n            this._shouldBroadcast = true;\r\n            requestAnimationFrame( () => {\r\n                if(this._shouldBroadcast)\r\n                {\r\n                    this._shouldBroadcast = false;\r\n                    this.Broadcast(this.data);\r\n                }\r\n            });\r\n        }\r\n\r\n        private Broadcast(arg: Com.IProgressData)\r\n        {\r\n            // Com.Log('Broadcast:', arg);\r\n            for(let i = 0; i < this._callbacks.length; i++) this._callbacks[i](arg);\r\n        }\r\n    }\r\n}\r\n","// Original source in @designhubz-widget\r\nimport { Com } from './Com';\r\n\r\nexport type TProgressCallback = (progress: number) => void;\r\n\r\nexport enum WidgetMsgType\r\n{\r\n    Snapshot = 'Snapshot',\r\n    Save = 'Save',\r\n    Debug = 'Debug',\r\n    Load = 'Load',\r\n    LoadVariation = 'LoadVariation',\r\n    TrackingStatusChange = 'TrackingStatusChange',\r\n    EyewearFit = 'EyewearFit'\r\n}\r\n\r\nexport namespace Progress\r\n{\r\n    export namespace ID\r\n    {\r\n        export const load = () => 'load';\r\n        export const assets = () => 'assets';\r\n        export const scene = (workspaceKey: string, productKey: string) => `LoadScene(${workspaceKey}, ${productKey})`;\r\n    }\r\n}\r\n\r\nexport namespace Editor\r\n{\r\n    export enum Mode\r\n    {\r\n        Default = 'default',\r\n        Export = 'export',\r\n        Geometry = 'geometry',\r\n        Variation = 'variation'\r\n    }\r\n}\r\n\r\nexport namespace Eyewear\r\n{\r\n    export const enum MsgType {\r\n        Idle = 'Idle',\r\n        CameraNotFound = 'CameraNotFound',\r\n        FaceNotFound = 'FaceNotFound',\r\n        Analyzing = 'Analyzing',\r\n        Tracking = 'Tracking'\r\n    }\r\n\r\n    export interface IStatusChangeNotification extends Com.IExternalMsg\r\n    {\r\n        __type: WidgetMsgType.TrackingStatusChange;\r\n        __details: {\r\n            status: MsgType;\r\n        };\r\n    }\r\n\r\n    export interface IEyewearFitRequest extends Com.IExternalMsg\r\n    {\r\n        __type: WidgetMsgType.EyewearFit;\r\n        __details: void;\r\n    }\r\n\r\n    export interface IEyewearFitResponse extends Com.IExternalMsg\r\n    {\r\n        __type: WidgetMsgType.EyewearFit;\r\n        __details: {\r\n            value: boolean;\r\n        };\r\n    }\r\n}\r\n\r\nexport interface ILoadVariationRequest extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.LoadVariation;\r\n    __details: {\r\n        workspaceKey: string;\r\n        productKey: string;\r\n    };\r\n}\r\n\r\nexport interface ILoadVariationResponse extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.LoadVariation;\r\n    __details: {\r\n        error?: string;\r\n    };\r\n}\r\n\r\nexport interface ISnapshotRequest extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Snapshot;\r\n    __details: {\r\n        flip: boolean;\r\n    };\r\n}\r\n\r\nexport interface ISnapshotResponse extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Snapshot;\r\n    __details: ImageData;\r\n}\r\n\r\nexport interface ISaveRequest extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Save;\r\n}\r\n\r\nexport interface ISaveResponse extends Com.IExternalMsg\r\n{\r\n    __type: WidgetMsgType.Save;\r\n    __details: boolean;\r\n}\r\n","import { IWidgetData, IViewerData, IEditorData } from './Data';\r\nexport * from './Data';\r\n\r\nimport * as _Storage from './Storage';\r\nexport import Storage = _Storage;\r\n\r\nexport * from './Com';\r\n\r\nimport * as _WidgetTypes from './WidgetTypes';\r\nexport import WidgetTypes = _WidgetTypes;\r\n\r\nimport * as _Internal from './Internal';\r\nexport import Internal = _Internal;\r\n\r\nexport let widget: IWidgetData;\r\nexport let viewer: IViewerData;\r\nexport let editor: IEditorData;\r\n\r\nexport function SetWidgetSource(value: IWidgetData)\r\n{\r\n    widget = value;\r\n}\r\nexport function SetViewerSource(value: IViewerData)\r\n{\r\n    viewer = value;\r\n    SetWidgetSource(value);\r\n}\r\nexport function SetEditorSource(value: IEditorData)\r\n{\r\n    editor = value;\r\n    SetViewerSource(value);\r\n}\r\n","import { IWidgetData, IViewerData, IEditorData, Storage, Errors } from '../data';\r\n\r\nconst searchParams = (new URL(window.location.href)).searchParams;\r\nconst local = Boolean(searchParams.get('local'));\r\nconst s3 = 'https://designhubz-viewer-data.s3-eu-west-1.amazonaws.com/';\r\nconst rootUrl = local ? 'https://localhost:2020/example/storage.ignore/' : s3;\r\nconst contentUrl = local ? 'https://localhost:2020/example/storage.ignore/content/' : s3 + 'content/';\r\n\r\n// const s3Apps = 'https://dg0iszzfyf3bz.cloudfront.net/';\r\nconst s3Apps = 'https://designhubz-viewer-data.s3-eu-west-1.amazonaws.com/apps/';\r\nconst extendsFlags = local ? '?local=1' : '?';\r\nconst appsUrls = {\r\n    viewer: (local ? 'https://localhost:2020/example/' : s3Apps + 'index.html') + extendsFlags,\r\n    editor: (local ? 'https://localhost:2020/example/editor.html' : s3Apps + 'editor.html') + extendsFlags,\r\n    digitization: (local ? 'https://localhost:2020/example/digitization.html' : s3Apps + 'digitization.html') + extendsFlags,\r\n    eyewear: (local ? 'https://localhost:2030/' : s3Apps + 'eyewear/index.html') + extendsFlags,\r\n    // eyewear: (local ? 'https://localhost:2030/' : s3Apps) + extendsFlags\r\n};\r\n\r\nconst blobToBuffer = (blob: Blob) => new Response(blob).arrayBuffer();\r\n\r\nconst fetchJSON = async (url: string) => {\r\n    try\r\n    {\r\n        const response = await fetch(url, { method: 'GET' });\r\n        return response.ok ? await response.json() : undefined;\r\n    }\r\n    catch(err)\r\n    {\r\n        console.warn(err);\r\n        return undefined;\r\n    }\r\n};\r\n// #endregion\r\n\r\n// https://designhubz-viewer-data.s3-eu-west-1.amazonaws.com/user/workspace/eyewear/glass1/scene.json\r\nconst folder = {\r\n    w: (workspaceKey: string) => `${rootUrl}user/workspace/${workspaceKey}/`,\r\n    s: (workspaceKey: string, productKey: string) => `${folder.w(workspaceKey)}scene/${productKey}/`,\r\n    sk: (workspaceKey: string) => `${folder.w(workspaceKey)}skin/`,\r\n    f: (publicFolderUrl: string) => publicFolderUrl.slice(rootUrl.length),\r\n    p: (workspaceKey: string) => `${folder.w(workspaceKey)}productData/`,\r\n    d: (workspaceKey: string) => `${folder.w(workspaceKey)}digitization/`,\r\n    a: () => `${rootUrl}user/sessions/`,\r\n    st: (path: string) => `storage.ignore/${folder.f(path)}`,\r\n    c: (url: string) => `${contentUrl}${url}`\r\n};\r\n\r\n// #region mock server interface (./publish/example/remote/server.js)\r\nconst serverUrl = 'http://127.0.0.1:8082/';\r\nasync function deleteAsync(path: string): Promise<void>\r\n{\r\n    let url = `${serverUrl}?path=${escape(folder.st(path))}`;\r\n    await fetch(url, { method: 'DELETE' });\r\n}\r\n\r\nasync function storeAsync(path: string, asset: ArrayBuffer | string): Promise<void>\r\n{\r\n    let url = `${serverUrl}?path=${escape(folder.st(path))}`;\r\n    await fetch(url, {\r\n        method: 'POST', \r\n        body: asset\r\n    });\r\n}\r\n// #endregion\r\n\r\nconst buildAppUrl = (url: string, params?: {}) => {\r\n    if(params !== undefined)\r\n    {\r\n        for(const key in params)\r\n        {\r\n            const value = (params as any)[key];\r\n            if(typeof value === 'string' && value !== 'undefined') url += `&${key}=${value}`;\r\n        }\r\n    }\r\n    return url;\r\n};\r\nconst widgetApps = {\r\n    viewer: (workspaceId?: string, referenceId?: string) => buildAppUrl(appsUrls.viewer, {workspaceId, referenceId}),\r\n    eyewear: (workspaceId?: string, referenceId?: string) => buildAppUrl(appsUrls.eyewear, {workspaceId, referenceId})\r\n};\r\n\r\nclass WidgetData implements IWidgetData\r\n{\r\n    readonly apps = widgetApps;\r\n\r\n    async FetchClientConfig(): Promise<Storage.IClientConfig>\r\n    {\r\n        return {\r\n            workspaces: {\r\n                '3D': 'eyewear',\r\n                'Eyewear': 'eyewear',\r\n                'Makeup': 'makeup'\r\n            }\r\n        };\r\n    }\r\n\r\n    async FetchProduct(workspaceId: string, referenceId: string, collectVariationDetails = true): Promise<Storage.IProduct>\r\n    {\r\n        const path = folder.p(workspaceId);\r\n        const product: Storage.IProduct = await fetchJSON(path + referenceId + '.json');\r\n        if(product === undefined) throw new Errors.NotFoundError();\r\n        return product;\r\n    }\r\n\r\n    async FetchProducts(workspaceId: string, referenceIdArray: string[], collectVariationDetails: boolean): Promise<Record<string, Storage.IProduct>>\r\n    {\r\n        const fetchUtil = async (id: string) => {\r\n            try\r\n            {\r\n                const product = await this.FetchProduct(workspaceId, id, collectVariationDetails);\r\n                return product;\r\n            }\r\n            catch(err)\r\n            {\r\n                if((err instanceof Errors.NotFoundError) === false) throw err;\r\n            }\r\n            return undefined;\r\n        };\r\n\r\n        const map: Record<string, Storage.IProduct> = {};\r\n        const products = await Promise.all(referenceIdArray.map(fetchUtil));\r\n        products.forEach( product => {\r\n            if(product !== undefined) map[product.referenceId] = product\r\n        });\r\n        \r\n        return map;\r\n    }\r\n\r\n    async FetchSession(sessionId: string): Promise<Storage.Input.ISessionData>\r\n    {\r\n        const path = folder.a();\r\n        const session: Storage.Input.ISessionData = await fetchJSON(path + sessionId + '.json');\r\n        if(session === undefined) throw new Errors.NotFoundError();\r\n        return session;\r\n    }\r\n    async CreateSession(workspaceId: string, referenceId: string, userId: string): Promise<string>\r\n    {\r\n        const sessionId = `${workspaceId}-${referenceId}-${userId}-${Date.now()}`;\r\n        return sessionId;\r\n    }\r\n    async UpdateSession(sessionId: string, data: Storage.Input.ISessionData): Promise<void>\r\n    {\r\n        const path = folder.a();\r\n        await storeAsync(path + sessionId + '.json', JSON.stringify(data));\r\n    }\r\n}\r\n\r\ninterface IMockScene extends Omit<Storage.IScene, 'publicFolderUrl'>\r\n{\r\n    _assetsUrls: Storage.IAssetUrl[];\r\n}\r\n\r\ninterface IMockSkin extends Omit<Storage.ISkin, 'publicFolderUrl'>\r\n{\r\n    _assetsUrls: Storage.IAssetUrl[];\r\n}\r\n\r\nconst resolveUrls = (publicFolderUrl: string, assetsUrls: Storage.IAssetUrl[]) => { \r\n    assetsUrls.forEach( v => (v as any).url = `${rootUrl}${publicFolderUrl}${v.name}` );\r\n};\r\n\r\nclass ViewerData extends WidgetData implements IViewerData\r\n{\r\n    async FetchScene(workspaceId: string, referenceId: string): Promise<Storage.IScene>\r\n    {\r\n        const path = folder.s(workspaceId, referenceId);\r\n        const scene: IMockScene = await fetchJSON(path + 'scene.json');\r\n        if(scene === undefined) throw new Errors.NotFoundError();\r\n        scene._assetsUrls = JSON.parse(JSON.stringify(scene.assetsUrls));\r\n        const publicFolderUrl = folder.f(path);\r\n        resolveUrls(publicFolderUrl, scene.assetsUrls);\r\n        return Object.assign({\r\n            publicFolderUrl: publicFolderUrl\r\n        }, scene);\r\n    }\r\n    async FetchSkin(workspaceId: string): Promise<Storage.ISkin>\r\n    {\r\n        const path = folder.w(workspaceId);\r\n        const skin: IMockSkin = await fetchJSON(path + 'skin.json');\r\n        if(skin === undefined) throw new Errors.NotFoundError();\r\n        skin._assetsUrls = JSON.parse(JSON.stringify(skin.assetsUrls));\r\n        const publicFolderUrl = folder.f(path);\r\n        resolveUrls(publicFolderUrl, skin.assetsUrls);\r\n        return Object.assign({\r\n            publicFolderUrl: publicFolderUrl\r\n        }, skin);\r\n    }\r\n}\r\n\r\nconst editorApps = Object.assign({\r\n    editor: (params?: {}) => buildAppUrl(appsUrls.editor, params),\r\n    digitization: (params?: {}) => buildAppUrl(appsUrls.digitization, params)\r\n}, widgetApps);\r\n\r\nexport class MockData extends ViewerData implements IEditorData\r\n{\r\n    readonly apps = editorApps;\r\n\t\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t\tconsole.log('MockData');\r\n\t}\r\n\r\n    async CreateScene(workspaceId: string, referenceId: string, name: string, sceneData?: Storage.Input.TJSON, files?: Storage.Input.IUploadAsset[]): Promise<Storage.IScene>\r\n    {\r\n        try\r\n        {\r\n            const oldScene = await this.FetchScene(workspaceId, referenceId);\r\n            console.warn('Scene already exists, will update...');\r\n            return await this.UpdateScene(workspaceId, referenceId, {\r\n                deleteFiles: oldScene.assetsUrls.map( asset => asset.name ),\r\n                name: name,\r\n                files: files,\r\n                sceneData: sceneData\r\n            });\r\n        }\r\n        catch(err)\r\n        {\r\n            if(err instanceof Errors.NotFoundError)\r\n            {\r\n                // Expected: Scene does not exist yet\r\n            }\r\n            else\r\n            {\r\n                throw err;\r\n            }\r\n        }\r\n\r\n        const path = folder.s(workspaceId, referenceId);\r\n\r\n        const assetsUrls: {name: string, url: string}[] = [];\r\n        if(files !== undefined) await Promise.all( files.map( async file => {\r\n            assetsUrls.push({\r\n                name: file.name,\r\n                url: file.name\r\n            });\r\n            return storeAsync(path + file.name, await blobToBuffer(file.content));\r\n        }));\r\n        \r\n        const scene: IMockScene = {\r\n            _assetsUrls: assetsUrls,\r\n            assetsUrls: assetsUrls,\r\n            createdAt: Date.now(),\r\n            isActive: false,\r\n            name: name,\r\n            sceneData: sceneData,\r\n            referenceId: referenceId,\r\n            workspaceId: workspaceId\r\n        };\r\n\r\n        let store: Storage.IScene | undefined;\r\n        while(store === undefined)\r\n        {\r\n            try\r\n            {\r\n                await storeAsync(path + 'scene.json', JSON.stringify(scene));\r\n                await new Promise( r => setTimeout(r, 1000) );\r\n                store = await this.FetchScene(workspaceId, referenceId);\r\n            }\r\n            catch(err)\r\n            {\r\n                console.log('failed to fetch scene, retrying');\r\n            }\r\n        }\r\n        return store;\r\n    }\r\n    async UpdateScene(workspaceId: string, referenceId: string, update: {\r\n        name?: string;\r\n        sceneData?: Storage.Input.TJSON;\r\n        files?: Storage.Input.IUploadAsset[],\r\n        deleteFiles?: string[]\r\n    }): Promise<Storage.IScene>\r\n    {\r\n        let scene = await this.FetchScene(workspaceId, referenceId);\r\n        if(update.name !== undefined) (scene as any).name = update.name;\r\n\r\n        const path = folder.s(workspaceId, referenceId);\r\n        const assetsUrls: IMockScene['_assetsUrls'] = (scene as any)._assetsUrls;\r\n        if(update.deleteFiles !== undefined)\r\n        {\r\n            await Promise.all( update.deleteFiles.map( filename => {\r\n                const i = assetsUrls.findIndex( v => v.name === filename );\r\n                if(i !== -1) assetsUrls.splice(i, 1);\r\n                return deleteAsync(path + filename);\r\n            }));\r\n        }\r\n        if(update.files !== undefined)\r\n        {\r\n            await Promise.all( update.files.map( async file => {\r\n                assetsUrls.push({\r\n                    name: file.name,\r\n                    url: file.name\r\n                });\r\n                return storeAsync(path + file.name, await blobToBuffer(file.content));\r\n            }));\r\n        }\r\n        if(update.sceneData !== undefined) (scene as any).sceneData = update.sceneData;\r\n        (scene as any).assetsUrls = assetsUrls;\r\n\r\n        await storeAsync(path + 'scene.json', JSON.stringify(scene));\r\n        return this.FetchScene(workspaceId, referenceId);\r\n    }\r\n    async DeleteScene(workspaceId: string, referenceId: string): Promise<void>\r\n    {\r\n        const scene = await this.FetchScene(workspaceId, referenceId);\r\n        const path = folder.s(workspaceId, referenceId);\r\n        await deleteAsync(path);\r\n    }\r\n\r\n    async UploadSceneAssets(workspaceId: string, referenceId: string, files: Storage.Input.IUploadAsset[]): Promise<Storage.IScene>\r\n    {\r\n        return this.UpdateScene(workspaceId, referenceId, {files: files});\r\n    }\r\n    async DeleteSceneAssets(workspaceId: string, referenceId: string, names: string[]): Promise<Storage.IScene>\r\n    {\r\n        return this.UpdateScene(workspaceId, referenceId, {deleteFiles: names});\r\n    }\r\n\r\n    async CreateSkin(workspaceId: string, skinData: Storage.Input.TJSON, files: Storage.Input.IUploadAsset[]): Promise<Storage.ISkin>\r\n    {\r\n        const path = folder.sk(workspaceId);\r\n\r\n        const assetsUrls: {name: string, url: string}[] = [];\r\n        if(files !== undefined) await Promise.all( files.map( async file => {\r\n            assetsUrls.push({\r\n                name: file.name,\r\n                url: file.name\r\n            });\r\n            return storeAsync(path + file.name, await blobToBuffer(file.content));\r\n        }));\r\n        \r\n        const skin: IMockSkin = {\r\n            _assetsUrls: assetsUrls,\r\n            assetsUrls: assetsUrls,\r\n            createdAt: Date.now(),\r\n            isActive: false,\r\n            skinData: skinData,\r\n            workspaceId: workspaceId\r\n        };\r\n        await storeAsync(path + 'skin.json', JSON.stringify(skin));\r\n\r\n        return this.FetchSkin(workspaceId);\r\n    }\r\n    async DeleteSkin(workspaceId: string): Promise<void>\r\n    {\r\n        const skin = await this.FetchSkin(workspaceId);\r\n        const path = folder.sk(workspaceId);\r\n        await deleteAsync(path);\r\n    }\r\n\r\n    async FetchDigitization(workspaceId: string, modelCode: string): Promise<Storage.IDigitization>\r\n    {\r\n        const path = folder.d(workspaceId);\r\n        const digitization: Storage.IDigitization = await fetchJSON(path + modelCode + '.json');\r\n        if(digitization === undefined) throw new Errors.NotFoundError();\r\n        return digitization;\r\n    }\r\n\r\n    async FetchContent<T>(url: string): Promise<{publicFolderUrl: string, content: T}>\r\n    {\r\n        const path = folder.c(url);\r\n        const content = await fetchJSON(path + '.json');\r\n        if(content === undefined) throw new Errors.NotFoundError();\r\n        const urlParts = path.split('/');\r\n        if(urlParts[urlParts.length - 1] !== '/')\r\n        {\r\n            urlParts.pop();\r\n            urlParts.push('');\r\n        }\r\n        \r\n        const publicFolderUrl = urlParts.join('/');\r\n        return {\r\n            publicFolderUrl: publicFolderUrl,\r\n            content\r\n        };\r\n    }\r\n}\r\n","// Original source in @designhubz-widget\r\nimport { Com } from '../data/Com';\r\n\r\nexport class InlineFrame extends Com\r\n{\r\n    public async ConnectToContainer()\r\n    {\r\n        await this.SendMsgAsync<Com.IInitResponse>({ __type: Com.MsgType.Init, __details: window.location.origin });\r\n    }\r\n\r\n    protected SendMsg(msg: Com.IExternalMsg, transfer?: Transferable[]): Com.IMsgData\r\n    {\r\n        // console.log(`[InlineFrame]`, JSON.parse(JSON.stringify(msg)));\r\n        const message = super.SendMsg(msg, transfer);\r\n        if(!parent) throw new Error(`Can't query parent window.`);\r\n\r\n        const origin = this._origin ?? '*';\r\n        if(transfer !== undefined) parent.postMessage(message, origin, transfer);\r\n        else parent.postMessage(message, origin, transfer);\r\n        return message;\r\n    }\r\n}\r\n\r\nexport class IframeContext extends InlineFrame\r\n{\r\n    constructor(private readonly _processMsgAsync: InlineFrame['ProcessMsgAsync'])\r\n    {\r\n        super();\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        let resolved = await super.ProcessMsgAsync(msg);\r\n        resolved = (await this._processMsgAsync(msg)) || resolved; \r\n        return resolved;\r\n    }\r\n\r\n    public Send<T extends Com.IExternalMsg>(msg: T)\r\n    {\r\n        return this.SendMsg(msg);\r\n    }\r\n\r\n    public async SendAsync<T extends Com.IExternalMsg>(msg: Com.IExternalMsg)\r\n    {\r\n        return this.SendMsgAsync<T>(msg);\r\n    }\r\n}\r\n\r\nexport class InlineFrameContainer extends Com\r\n{\r\n    constructor(protected readonly iframe: HTMLIFrameElement)\r\n    {\r\n        super();\r\n    }\r\n\r\n    protected SendMsg(msg: Com.IExternalMsg, transfer?: Transferable[]): Com.IMsgData\r\n    {\r\n        const message = super.SendMsg(msg, transfer);\r\n        if(this.iframe.contentWindow === null) throw new Error(`Can't query iframe's contentWindow.`);\r\n\r\n        const origin = this._origin ?? '*';\r\n        if(transfer !== undefined) this.iframe.contentWindow!.postMessage(message, origin, transfer);\r\n        else this.iframe.contentWindow!.postMessage(message, origin);\r\n        return message;\r\n    }\r\n\r\n    protected Dispose()\r\n    {\r\n        if(this.iframe.parentElement !== null) this.iframe.parentElement.removeChild(this.iframe);\r\n    }\r\n}","import { Dev } from '../api';\r\n\r\nconst formatOptions = ['font-weight', 'color', 'background'];\r\n\r\nexport const _dev = new (\r\n    class _Dev implements Dev\r\n    {\r\n        public debug = false;\r\n\r\n        public Log(...args: Array<any>)\r\n        {\r\n            if(this.debug)\r\n            {\r\n                const formatting: string[] = [];\r\n                for(let i = 0; i < args.length - 1; i++)\r\n                {\r\n                    const arg = args[i];\r\n                    const text = args[i + 1];\r\n                    if(typeof arg === 'string' && typeof text === 'string' && arg.slice(0, 2) === '#(')\r\n                    {\r\n                        const optionsArgs = arg.slice(2, arg.length - 1).split(',');\r\n                        let format = formatOptions.map( (o, i) => \r\n                            typeof optionsArgs[i] === 'string' && optionsArgs[i].length > 0\r\n                                ? `${o}:${optionsArgs[i]};`\r\n                            : ''\r\n                        ).join(' ');\r\n                        \r\n                        args.splice(i, 1);\r\n                        args[i] = `%c ${text} `;\r\n                        formatting.push(format);\r\n                    }\r\n                }\r\n                if(formatting.length > 0) console.log(args.map( arg => arg.toString() ).join(''), ...formatting);\r\n                else console.log(...args);\r\n            }\r\n        }\r\n\r\n        public CreateError(name: string, message?: string)\r\n        {\r\n            this.Log(`Created ERROR '${name}': '${message}'`);\r\n            const error = new Error(message);\r\n            error.name = name;\r\n            return error;\r\n        }\r\n    }\r\n);\r\n","\r\nimport { SetEditorSource } from '../data';\r\nimport { MockData } from '../data-source';\r\nimport { _dev } from './_Dev';\r\n\r\nif(!window.location) throw new Error('Expected access to window.location');\r\nif(!('href' in window.location)) throw new Error('Expected href in window.location');\r\n\r\nSetEditorSource(new MockData());\r\n\r\n/** enabled = ?designhubz_debug=bool */\r\nexport const DEV_DEBUG_URL_PARAM = 'designhubz_debug';\r\nconst bool = (p: string | null) => p === '1' || p === 'true';\r\nconst searchParams = (new URL(window.location.href)).searchParams;\r\nif(bool(searchParams.get(DEV_DEBUG_URL_PARAM))) _dev.debug = true;\r\n","import { IProduct, IScoredRecommendation } from '../../api';\r\n\r\nexport abstract class _Product<T> implements IProduct<T>\r\n{\r\n    public readonly is3D = () => false;\r\n    public readonly isEyewear = () => false;\r\n    public readonly isMakeup = () => false;\r\n\r\n    public readonly variations: this[];\r\n\r\n    constructor(\r\n        public readonly workspaceKey: string,\r\n        public readonly productKey: string,\r\n        public readonly properties: T,\r\n        variations: _Product<T>[]\r\n    )\r\n    {\r\n        this.variations = variations as this[];\r\n    }\r\n\r\n    public get thumbnailURL(){ return ''; }\r\n\r\n    public fetchRecommendations(num: number, external?: IScoredRecommendation[]): Promise<IScoredRecommendation[]>\r\n    {\r\n        const recommendations = new Array<IScoredRecommendation>(num);\r\n        recommendations.map( (_, i) => { \r\n            return {\r\n                sku: i.toString(),\r\n                score: i / num\r\n            };\r\n        });\r\n        return new Promise( r => r(recommendations) );\r\n    }\r\n\r\n    public toJSON(): any\r\n    {\r\n        return Object.assign({}, this, {\r\n            variations: this.variations.map( v => {\r\n                const variation = Object.assign({}, v);\r\n                // @ts-ignore\r\n                delete variation.variations;\r\n                return variation;\r\n            })\r\n        })\r\n    }\r\n}\r\n","\r\nexport namespace Dom\r\n{\r\n    export function CreateStylesheet(css: string)\r\n    {\r\n        const style = document.createElement('style');\r\n        style.type = 'text/css';\r\n        style.innerHTML = css;\r\n        document.getElementsByTagName('head')[0].appendChild(style);\r\n        return style;\r\n    }\r\n\r\n    export function BuildHTML<T extends HTMLElement>(html: string): T\r\n    {\r\n        const div = document.createElement('div');\r\n        div.innerHTML = html.trim();\r\n        return div.firstChild as T;\r\n    }\r\n}\r\n","type callback<T> = (arg: T) => void;\r\n\r\nexport interface ISignal<T>\r\n{\r\n    Add(callback: callback<T>): void;\r\n    Remove(callback: callback<T>): void;\r\n    Once(callback: callback<T>): void;\r\n}\r\n\r\nexport class Signal<T> implements ISignal<T>\r\n{\r\n    public callbacks: callback<T>[];\r\n\r\n    constructor()\r\n    {\r\n        this.callbacks = [];\r\n    }\r\n\r\n    public Add(callback: callback<T>)\r\n    {\r\n        if(typeof callback !== 'function')\r\n        {\r\n            console.warn('Not a function', callback);\r\n            throw(\"'callback' should be a function.\");\r\n        }\r\n        this.callbacks.push(callback);\r\n    }\r\n\r\n    public Remove(callback: callback<T>)\r\n    {\r\n        const index = this.callbacks.indexOf(callback);\r\n        if(index !== -1) this.callbacks.splice(index, 1);\r\n    }\r\n\r\n    public Dispatch(arg: T)\r\n    {\r\n        for(let i = 0; i < this.callbacks.length; i++) this.callbacks[i](arg);\r\n    }\r\n\r\n    public Once(callback: callback<T>)\r\n    {\r\n        const once = (arg: T) => {\r\n            this.Remove(once);\r\n            callback(arg);\r\n        };\r\n        this.Add(once);\r\n    }\r\n}\r\n","console.log('@designhubz-widget/utils');\r\n\r\nexport * from './Browser';\r\nexport * from './Signals';","import { ISnapshot } from '../../api';\r\n\r\ntype TImageSource = (CanvasImageSource & {width: number, height: number}) | ImageData;\r\nlet _canvas: HTMLCanvasElement;\r\n\r\nfunction DrawToCanvas(source: TImageSource, flip: boolean)\r\n{\r\n    if(_canvas === undefined) _canvas = document.createElement('canvas');\r\n\r\n\t_canvas.width = source.width;\r\n\t_canvas.height = source.height;\r\n\r\n    const context = _canvas.getContext('2d')!;\r\n    context.resetTransform();\r\n    if(flip)\r\n    {\r\n        context.translate(0, _canvas.height);\r\n        context.scale(1, -1);\r\n    }\r\n\r\n    if(source instanceof ImageData) context.putImageData(source, 0, 0);\r\n    else context.drawImage(source, 0, 0, source.width, source.height);\r\n    return _canvas;\r\n}\r\n\r\nexport class Snapshot implements ISnapshot\r\n{\r\n    constructor(public readonly imageData: ImageData)\r\n    {}\r\n\r\n    public getDataURL(type: 'jpeg' | 'png', quality?: number)\r\n    {\r\n        const canvas =  DrawToCanvas(this.imageData, false);\r\n        return canvas.toDataURL(type === 'jpeg' ? 'image/jpeg' : 'image/png', quality)\r\n    }\r\n\r\n    public async getBlobAsync(type: 'jpeg' | 'png', quality?: number)\r\n    {\r\n        const canvas =  DrawToCanvas(this.imageData, false);\r\n        const blob = await new Promise<Blob>( (resolve, reject) => \r\n            canvas.toBlob( blob => {\r\n                if(blob === null) reject('Failed to generate Blob');\r\n                else resolve(blob);\r\n            }, type === 'jpeg' ? 'image/jpeg' : 'image/png', quality)\r\n        );\r\n\r\n        return blob;\r\n    }\r\n}\r\n","import { IWidget, IProduct, Stat, TProgressCallback } from '../../api';\r\nimport { Dom } from '../../utils';\r\nimport { _dev } from '../_Dev';\r\nimport { _Product } from '../products/_Product';\r\nimport { Snapshot } from './Snapshot';\r\nimport { InlineFrameContainer } from '../../data-source/InlineFrame';\r\nimport { Com } from '../../data/Com'; \r\nimport * as WidgetTypes from '../../data/WidgetTypes';\r\n\r\nCom.source = 'Widget';\r\n\r\nconst createIframe = () => Dom.BuildHTML<HTMLIFrameElement>(`<iframe\r\nstyle=\"width: 1px; min-width: 100%; *width: 100%; height: 1px; min-height: 100%; *height: 100%;\" \r\nwidth=\"100%\" height=\"100%\" scrolling=\"no\" frameBorder=\"0\"\r\n</iframe>`);\r\n\r\nexport abstract class _Widget<T, P extends IProduct<T>> extends InlineFrameContainer implements IWidget<T, P>\r\n{\r\n    protected _variation?: P;\r\n\r\n    constructor(public readonly domElement: HTMLDivElement)\r\n    {\r\n        super(createIframe());\r\n    }\r\n\r\n    public get variation()\r\n    {\r\n        if(this._variation === undefined) throw new Error(`Widget's variation is not ready`);\r\n        return this._variation;\r\n    }\r\n\r\n    // public async Load(progressHandler?: TProgressCallback)\r\n    // {\r\n    //     await this.waitForInit;\r\n\r\n    //     const loadId = WidgetTypes.Progress.ID.load();\r\n    //     this.TrackProgress(loadId, data => {\r\n    //         if(data.error !== undefined) throw data.error;\r\n    //         if(progressHandler !== undefined) progressHandler(data.progress);\r\n    //     });\r\n    // }\r\n\r\n    public async FirstLoadAsync(variation: P | null, progressHandler?: TProgressCallback, loadRatio = .2, sceneLoadRatio = .8)\r\n    {\r\n        await this.waitForInit;\r\n\r\n        const loadId = WidgetTypes.Progress.ID.load();\r\n        const sceneLoadId = variation === null \r\n            ? WidgetTypes.Progress.ID.assets()\r\n        : WidgetTypes.Progress.ID.scene(variation.workspaceKey, variation.productKey);\r\n\r\n        const bundleRatios = {\r\n            [loadId]: loadRatio,\r\n            [sceneLoadId]: sceneLoadRatio\r\n        };\r\n\r\n        const loadProgressAsync = new Promise<void>( resolve => {\r\n            this.TrackProgressBundle(bundleRatios, data => {\r\n                if(data.error !== undefined) throw data.error;\r\n                if(progressHandler !== undefined) progressHandler(data.progress);\r\n                if(data.completed)\r\n                {\r\n                    _dev.Log('FirstLoadAsync', data);\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n\r\n        let loadVariationAsync = variation !== null ? this.loadVariation(variation) : Promise.resolve();\r\n        await Promise.all([loadProgressAsync, loadVariationAsync]);\r\n    }\r\n\r\n    public async loadVariation(variation: P, progressHandler?: TProgressCallback)\r\n    {\r\n        // First step towards Widget then product\r\n        // if(this._variation !== undefined \r\n        //     && this._variation.variations.every( v => v.productKey !== variation.productKey )\r\n        // )\r\n        // {\r\n        //     throw new Error(`Product '${variation.productKey}' is not a variation of ${this._variation.variations.map( v => v.productKey ).join(', ')}`);\r\n        // }\r\n        \r\n        if(progressHandler !== undefined)\r\n        {\r\n            const id = WidgetTypes.Progress.ID.scene(variation.workspaceKey, variation.productKey);\r\n            this.TrackProgress(id, data => {\r\n                if(data.error !== undefined) throw data.error;\r\n                if(progressHandler !== undefined) progressHandler(data.progress);\r\n            });\r\n        }\r\n\r\n        const request: WidgetTypes.ILoadVariationRequest = {\r\n            __type: WidgetTypes.WidgetMsgType.LoadVariation,\r\n            __details: {\r\n                workspaceKey: variation.workspaceKey,\r\n                productKey: variation.productKey\r\n            }\r\n        };\r\n        \r\n        const response = await this.SendMsgAsync<WidgetTypes.ILoadVariationResponse>(request);\r\n        if(response.__details.error !== undefined) throw new Error(`Error loading variation: ${response.__details.error}`);\r\n\r\n        this._variation = variation;\r\n        _dev.Log('#(bold,#f00)', 'variation loaded:', '#()', `(${this._variation.productKey})`);\r\n    }\r\n\r\n    public async takeSnapshotAsync()\r\n    {\r\n        const request: WidgetTypes.ISnapshotRequest = {\r\n            __type: WidgetTypes.WidgetMsgType.Snapshot,\r\n            __details: {\r\n                flip: false\r\n            }\r\n        };\r\n        const response = await this.SendMsgAsync<WidgetTypes.ISnapshotResponse>(request);\r\n        const source = response.__details;\r\n        const imageData = new ImageData(new Uint8ClampedArray(source.data), source.width, source.height);\r\n        return new Snapshot(imageData);\r\n    }\r\n\r\n    public sendStat(stat: Stat)\r\n    {\r\n        return Promise.resolve();\r\n    }\r\n\r\n    public async disposeAsync()\r\n    {\r\n        this.Dispose();\r\n    }\r\n\r\n    protected SetApp(url: string)\r\n    {\r\n        if(typeof this.iframe.src === 'string' && this.iframe.src.length > 0)\r\n        {\r\n            throw new Error('Call dispose before setting iframe src again.');\r\n        }\r\n\r\n        this.iframe.src = url;\r\n\r\n        // TODO: what kind of dom events do we handle?\r\n        this.domElement.appendChild(this.iframe);\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        let resolved = await super.ProcessMsgAsync(msg);\r\n        switch(msg.__type)\r\n        {\r\n            default:\r\n                // if(resolved === false) _dev.Log(`No listeners on '${msg.__type}'`, msg);\r\n            break;\r\n        }\r\n        return resolved;\r\n    }\r\n}","import { I3DWidget } from '../../api';\r\nimport { editor as Data } from '../../data';\r\nimport { _Widget } from './_Widget';\r\nimport { _Product } from '../products/_Product';\r\nimport { _3DProduct } from '../products/_3DProduct';\r\n\r\n\r\nexport class _3DWidget<T, P extends _3DProduct<T>> extends _Widget<T, P> implements I3DWidget<T>\r\n{\r\n    public _3D = true;\r\n\r\n    constructor(\r\n        domElement: HTMLDivElement,\r\n        app?: string\r\n    ){\r\n        super(domElement);\r\n\r\n        if(app === undefined) app = Data.apps.viewer();\r\n        this.SetApp(app);\r\n    }\r\n}","import { I3DProduct, TProgressCallback } from '../../api';\r\nimport { _Product } from './_Product';\r\nimport { _3DWidget } from '../widgets/_3DWidget';\r\n\r\nexport class _3DProduct<T> extends _Product<T> implements I3DProduct<T>\r\n{\r\n    public _3D = true;\r\n    public readonly is3D = () => true;\r\n    \r\n    public async create3DWidget(domElement: HTMLDivElement, progressHandler?: TProgressCallback): Promise<_3DWidget<T, this>>\r\n    {\r\n        const widget = new _3DWidget<T, this>(domElement);\r\n        await widget.FirstLoadAsync(this, progressHandler, .2, .8);\r\n        return widget;\r\n    }\r\n}\r\n","import { IEyewearWidget, TrackingStatus } from '../../api';\r\nimport { ISignal, Signal } from '../../utils';\r\nimport { editor as Data, Com, WidgetTypes } from '../../data';\r\nimport { _dev } from '../_Dev';\r\nimport { _Widget } from './_Widget';\r\nimport { _EyewearProduct } from '../products/_EyewearProduct';\r\n\r\nexport class _EyewearWidget<T, P extends _EyewearProduct<T>> extends _Widget<T, P> implements IEyewearWidget<T>\r\n{\r\n    public _eyewear = true;\r\n    \r\n    public readonly onTrackingStatusChange: ISignal<TrackingStatus> = new Signal();\r\n    \r\n    constructor(\r\n        domElement: HTMLDivElement\r\n    ){\r\n        super(domElement);\r\n\r\n        this.iframe.setAttribute('allow', 'camera;microphone');\r\n        const app = Data.apps.eyewear();\r\n        // const app = Data.apps.viewer();\r\n        this.SetApp(app);\r\n    }\r\n\r\n    public async queryFit()\r\n    {\r\n        const request: WidgetTypes.Eyewear.IEyewearFitRequest = {\r\n            __type: WidgetTypes.WidgetMsgType.EyewearFit,\r\n            __details: void 0\r\n        };\r\n\r\n        const response = await this.SendMsgAsync<WidgetTypes.Eyewear.IEyewearFitResponse>(request);\r\n        return true;//Boolean(response.__details?.value);\r\n    }\r\n\r\n    protected async ProcessMsgAsync(msg: Com.IMsgData): Promise<boolean>\r\n    {\r\n        let resolved = await super.ProcessMsgAsync(msg);\r\n        switch(msg.__type)\r\n        {\r\n            case WidgetTypes.WidgetMsgType.TrackingStatusChange: {\r\n                const details = (msg as WidgetTypes.Eyewear.IStatusChangeNotification).__details;\r\n                const status = details.status as any as TrackingStatus;\r\n                (this.onTrackingStatusChange as Signal<TrackingStatus>).Dispatch(status);\r\n                return true;\r\n            }\r\n            default:\r\n                // if(resolved === false) _dev.Log(`No listeners on '${msg.__type}'`, msg);\r\n            break;\r\n        }\r\n        return resolved;\r\n    }\r\n}","import { IEyewearProduct, TProgressCallback } from '../../api';\r\nimport { _3DProduct } from './_3DProduct';\r\nimport { _3DWidget } from '../widgets/_3DWidget';\r\nimport { _EyewearWidget } from '../widgets/_EyewearWidget';\r\n\r\nexport class _EyewearProduct<T> extends _3DProduct<T> implements IEyewearProduct<T>\r\n{\r\n    public _eyewear = true;\r\n    public _3D = true;\r\n    public readonly isEyewear = () => true;\r\n\r\n    public async createEyewearWidget(domElement: HTMLDivElement, progressHandler?: TProgressCallback): Promise<_EyewearWidget<T, this>>\r\n    {\r\n        const widget = new _EyewearWidget<T, this>(domElement);\r\n        console.log('FirstLoadAsync start');\r\n        await widget.FirstLoadAsync(this, progressHandler, .8, .2);\r\n        console.log('FirstLoadAsync end');\r\n        return widget;\r\n    }\r\n\r\n    public async createMultiWidget(domElement: HTMLDivElement, progressHandler?: TProgressCallback): Promise<any>\r\n    {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n}\r\n","import { Internal } from '../../data';\r\nimport { _Product } from './_Product';\r\nimport { _3DProduct } from './_3DProduct';\r\nimport { _EyewearProduct } from './_EyewearProduct';\r\nimport { TProps } from '../../api';\r\n\r\nconst _productsCache: Record<string, _Product<any>> = {};\r\nexport function ProductFromCache<T>(workspaceKey: string, productKey: string): _Product<T> | undefined\r\n{\r\n    return _productsCache[workspaceKey + productKey];\r\n}\r\n\r\nconst _variationsCache: Record<string, _Product<any>[]> = {};\r\nfunction VariationsFromCache<T>(workspaceKey: string, productKey: string): _Product<T>[] | undefined\r\n{\r\n    return _variationsCache[workspaceKey + productKey];\r\n}\r\n\r\nexport function ProductFromData<T extends TProps>(data: Internal.IProductData, props?: T)\r\n{\r\n    // console.log('From product data', data);\r\n    let product = ProductFromCache<T>(data.workspaceKey, data.productKey);\r\n    if(product !== undefined) return product;\r\n\r\n    let variations = VariationsFromCache<T>(data.workspaceKey, data.productKey);\r\n    if(variations === undefined)\r\n    {\r\n        variations = [];\r\n        data.variations.forEach( variation => {\r\n            if(variation.productKey !== data.productKey)\r\n            {\r\n                const vData = Object.assign({}, data, variation);\r\n                _variationsCache[vData.workspaceKey + vData.productKey] = variations!;\r\n                variations!.push(ProductFromData(vData, props));\r\n            }\r\n        });\r\n    }\r\n\r\n    if(props !== undefined)\r\n    {\r\n        let missingProps: string[] = [];\r\n        for(const key in props)\r\n        {\r\n            const header = props[key];\r\n            if(typeof header === 'string')\r\n            {\r\n                if(header in data.properties)\r\n                {\r\n                    if(key in data.properties) console.warn(`Custom property accessor '${key}' will override existing property.`);\r\n                    Object.defineProperty(data.properties, key, {\r\n                        get: () => data.properties[header]\r\n                    });\r\n                }\r\n                else \r\n                {\r\n                    missingProps.push(header);\r\n                }\r\n            }\r\n        }\r\n\r\n        if(missingProps.length > 0)\r\n        {\r\n            const plr = missingProps.length > 1;\r\n            console.warn(`Custom propert${plr ? 'ies' : 'y'}: '${missingProps.join(`', '`)}' ${plr ? 'are' : 'is'} missing from '${data.productKey}'`);\r\n        }\r\n    }\r\n\r\n    const productArgs: [string, string, T, _Product<T>[]] = [\r\n        data.workspaceKey,\r\n        data.productKey,\r\n        data.properties,\r\n        variations\r\n    ];\r\n\r\n    // console.log('productArgs', productArgs);\r\n\r\n    switch(data.productType)\r\n    {\r\n        case '3D':\r\n            product = new _3DProduct<T>(...productArgs);\r\n        break;\r\n        case 'Eyewear':\r\n            product = new _EyewearProduct<T>(...productArgs);\r\n        break;\r\n        case 'Makeup':\r\n            throw 'Makeup type not implemented';\r\n        default:\r\n            throw 'productType is undefined';\r\n    }\r\n\r\n    variations.push(product);\r\n    _productsCache[data.workspaceKey + data.productKey] = product;\r\n    return product;\r\n}\r\n","import { Storage } from '../data';\r\n\r\ninterface IConfig\r\n{\r\n    readonly workspaces: Record<Storage.TProductType, string>;\r\n}\r\n\r\nexport const configAsync: Promise<IConfig> = new Promise( (resolve, reject) => {\r\n    resolve({\r\n        workspaces: {\r\n            '3D': 'eyewear',\r\n            'Eyewear': 'eyewear',\r\n            'Makeup': 'makeup'\r\n        }\r\n    });\r\n});","import { IProduct, IEyewearProduct, IMakeupProduct, TProps,  } from '../api';\r\nimport { widget as Data, Internal } from '../data';\r\nimport { _Product } from './products/_Product';\r\nimport { ProductFromCache, ProductFromData } from './products/Factory';\r\nimport { _dev } from './_Dev';\r\nimport { configAsync } from './_Config';\r\n\r\nexport * from '../api';\r\n\r\nexport const version: string = '0.0.7';\r\n\r\nexport const dev = _dev;\r\n\r\nexport async function fetchProduct<T extends TProps>(workspaceKey: string, productKey: string, props?: T): Promise<IProduct<T>>\r\n{\r\n    if(typeof workspaceKey !== 'string' || typeof productKey !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchProduct(${workspaceKey}: string, ${productKey}: string)`);\r\n    let product = ProductFromCache<T>(workspaceKey, productKey);\r\n    if(product === undefined)\r\n    {\r\n        _dev.Log('#(bold,#f00)', 'fetching product:', '#()', `(${workspaceKey}, ${productKey})`);\r\n        const productData = await Data.FetchProduct(workspaceKey, productKey, true);\r\n        \r\n        const variations: Internal.IProductData['variations'] = [];\r\n        productData.variations.forEach( v => {\r\n            // if(v.referenceId !== productKey)\r\n            // {\r\n                variations.push({\r\n                    productKey: v.referenceId,\r\n                    name: v.name,\r\n                    properties: Object.assign({}, v.originalProperties)\r\n                });\r\n            // }\r\n        });\r\n\r\n        product = ProductFromData<T>({\r\n            workspaceKey: workspaceKey,\r\n            productKey: productKey,\r\n            name: productData.name,\r\n            productType: 'Eyewear',\r\n            properties: Object.assign({}, productData.originalProperties),\r\n            variations: variations\r\n        }, props);\r\n\r\n        // console.log('*** fetched product', JSON.parse(JSON.stringify(product)));\r\n    }\r\n    else\r\n    {\r\n        _dev.Log('#(bold,#f88)', '(cache) fetching product:', '#()', `(${workspaceKey} | ${productKey})`);\r\n    }\r\n    return product;\r\n}\r\n\r\nexport async function fetchProducts<T extends TProps>(workspaceKey: string, productKeys: string[], props?: T): Promise<Record<string, IProduct<T> | undefined>>\r\n{\r\n    if(typeof workspaceKey !== 'string' || (productKeys instanceof Array) === false || productKeys.length === 0 || typeof productKeys[0] !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchProducts(${workspaceKey}: string, ${productKeys.join(', ')}: string[])`);\r\n    \r\n    _dev.Log('#(bold,#000)', 'fetching products:', '#()', `(${workspaceKey}, [${productKeys.join(', ')}])`);\r\n\r\n    const result: Record<string, IProduct<T> | undefined> = {};\r\n    const stats = {cache: 0, fetch: 0, missing: productKeys.length};\r\n    const productsToFetch: string[] = [];\r\n    productKeys.forEach( productKey => {\r\n        const product = ProductFromCache<T>(workspaceKey, productKey);\r\n        if(product === undefined)\r\n        {\r\n            productsToFetch.push(productKey);\r\n        }\r\n        else\r\n        {\r\n            stats.cache++;\r\n            stats.missing--;\r\n            result[productKey] = product;\r\n        }\r\n    });\r\n    if(productsToFetch.length > 0)\r\n    {\r\n        const productsDataMap = await Data.FetchProducts(workspaceKey, productsToFetch, true);\r\n        productsToFetch.forEach( productKey => {\r\n            const productData = productsDataMap[productKey];\r\n            if(productData !== undefined)\r\n            {\r\n                stats.fetch++;\r\n                stats.missing--;\r\n                result[productKey] = ProductFromData<T>({\r\n                    workspaceKey: workspaceKey,\r\n                    productKey: productKey,\r\n                    name: productData.name,\r\n                    productType: 'Eyewear',\r\n                    properties: Object.assign({}, productData.originalProperties),\r\n                    variations: productData.variations.filter( v => v.referenceId !== productKey ).map( v => {\r\n                        return {\r\n                            productKey: v.referenceId,\r\n                            name: v.name,\r\n                            properties: Object.assign({}, v.originalProperties)\r\n                        };\r\n                    })\r\n                }, props);\r\n            }\r\n        });\r\n    }\r\n    _dev.Log(\r\n        '#(,#f88)', `${stats.cache} from cache`, ' | ', \r\n        stats.fetch > 0 ? '#(bold,#f00)' : '#(bold)', `${stats.fetch} fetched`, ' | ', \r\n        stats.missing > 0 ? '#(#fff,#f00)' : '#(bold)', `${stats.missing} missing`);\r\n    return result;\r\n}\r\n\r\nexport async function fetchEyewearProduct<T extends TProps>(productKey: string, props?: T): Promise<IEyewearProduct<T>>\r\n{\r\n    if(typeof productKey !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchEyewearProduct(${productKey}: string)`);\r\n    \r\n    const workspaceKey = (await configAsync).workspaces.Eyewear;\r\n    const product = await fetchProduct(workspaceKey, productKey, props);\r\n    if(product.isEyewear()) return product;\r\n    else throw new Error(`${productKey} is not of 'Eyewear' type.`);\r\n}\r\n\r\nexport async function fetchMakeupProduct<T extends TProps>(productKey: string, props?: T): Promise<IMakeupProduct<T>>\r\n{\r\n    if(typeof productKey !== 'string')\r\n        throw new RangeError(`Invalid arguments: fetchMakeupProduct(${productKey}: string)`);\r\n\r\n    const workspaceKey = (await configAsync).workspaces.Makeup;\r\n    const product = await fetchProduct(workspaceKey, productKey, props);\r\n    if(product.isMakeup()) return product;\r\n    else throw new Error(`${productKey} is not of 'Makeup' type.`);\r\n}","console.log('@designhubz-widget/lib');\r\n\r\nimport './_Data';\r\nexport * from './_API';\r\n"],"names":["searchParams","WidgetTypes.Progress","WidgetTypes.WidgetMsgType","Data"],"mappings":"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"}